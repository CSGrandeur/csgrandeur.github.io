<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.csgrandeur.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"default"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="CSGrandeur&#39;s Thinking">
<meta property="og:url" content="http://blog.csgrandeur.cn/index.html">
<meta property="og:site_name" content="CSGrandeur&#39;s Thinking">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="CSGrandeur">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://blog.csgrandeur.cn/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>CSGrandeur's Thinking</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?7958adf931092425a489778560129144"></script>







  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">CSGrandeur's Thinking</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Cogito Ergo Sum</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">CSGrandeur</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">81</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.csgrandeur.cn/2025-12-23-13-%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CSGrandeur">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025-12-23-13-%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">13.后端开发基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-12-23 13:32:38 / 修改时间：18:40:01" itemprop="dateCreated datePublished" datetime="2025-12-23T13:32:38+08:00">2025-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="数据库设计">1. 数据库设计</h1>
<h2 id="为什么需要选择合适的数据类型">1.1
为什么需要选择合适的数据类型？</h2>
<p><strong>问题</strong>：设计数据库表时，如何选择字段的数据类型？</p>
<p><strong>生活类比</strong>：</p>
<ul>
<li><strong>用大箱子装小东西</strong>：浪费空间，搬运困难</li>
<li><strong>用小箱子装大东西</strong>：装不下，需要换箱子</li>
<li><strong>用合适的箱子</strong>：既不浪费，又能装下</li>
</ul>
<p><strong>实际例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ❌ 不好的选择</span></span><br><span class="line">age TINYINT        <span class="comment">-- 年龄用TINYINT（-128到127），足够了</span></span><br><span class="line">status <span class="type">INT</span>         <span class="comment">-- 状态用INT（-21亿到21亿），太浪费了！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✅ 好的选择</span></span><br><span class="line">age TINYINT UNSIGNED  <span class="comment">-- 年龄0-255，足够用</span></span><br><span class="line">status TINYINT        <span class="comment">-- 状态0-255，足够用（0=未激活，1=已激活，2=已删除）</span></span><br></pre></td></tr></table></figure>
<p><strong>选择合适数据类型的好处</strong>：</p>
<ul>
<li>✅
<strong>节省存储空间</strong>：数据量大的时候，节省的空间很可观</li>
<li>✅ <strong>提高查询速度</strong>：数据类型越小，查询越快</li>
<li>✅ <strong>避免数据错误</strong>：限制数据范围，防止无效数据</li>
</ul>
<hr />
<h2 id="mysql整数类型">1.2 MySQL整数类型</h2>
<h3 id="整数类型对比">1.2.1 整数类型对比</h3>
<table>
<thead>
<tr class="header">
<th>类型</th>
<th>字节</th>
<th>有符号范围</th>
<th>无符号范围</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>TINYINT</strong></td>
<td>1</td>
<td>-128 ~ 127</td>
<td>0 ~ 255</td>
<td>年龄、状态码、是否删除</td>
</tr>
<tr class="even">
<td><strong>SMALLINT</strong></td>
<td>2</td>
<td>-32768 ~ 32767</td>
<td>0 ~ 65535</td>
<td>年份、小数量</td>
</tr>
<tr class="odd">
<td><strong>MEDIUMINT</strong></td>
<td>3</td>
<td>-8388608 ~ 8388607</td>
<td>0 ~ 16777215</td>
<td>中等数量</td>
</tr>
<tr class="even">
<td><strong>INT</strong></td>
<td>4</td>
<td>-21亿 ~ 21亿</td>
<td>0 ~ 42亿</td>
<td>用户ID、文章ID（常用）</td>
</tr>
<tr class="odd">
<td><strong>BIGINT</strong></td>
<td>8</td>
<td>超大范围</td>
<td>超大范围</td>
<td>超大数据量、时间戳</td>
</tr>
</tbody>
</table>
<h3 id="实际选型例子">1.2.2 实际选型例子</h3>
<p><strong>用户ID（主键）</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 推荐：INT UNSIGNED</span></span><br><span class="line">id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span></span><br><span class="line"><span class="comment">-- 范围：0 ~ 42亿，足够大多数应用使用</span></span><br><span class="line"><span class="comment">-- 如果用户量可能超过42亿，用BIGINT</span></span><br></pre></td></tr></table></figure>
<p><strong>年龄</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 推荐：TINYINT UNSIGNED</span></span><br><span class="line">age TINYINT UNSIGNED</span><br><span class="line"><span class="comment">-- 范围：0 ~ 255，足够存储年龄</span></span><br><span class="line"><span class="comment">-- 节省空间：1字节 vs INT的4字节，节省75%空间</span></span><br></pre></td></tr></table></figure>
<p><strong>状态码</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 推荐：TINYINT</span></span><br><span class="line">status TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span></span><br><span class="line"><span class="comment">-- 0=未激活，1=已激活，2=已删除，3=已禁用</span></span><br><span class="line"><span class="comment">-- 范围：-128 ~ 127，足够用</span></span><br><span class="line"><span class="comment">-- 如果只用0和1，可以用TINYINT(1)或BOOLEAN</span></span><br></pre></td></tr></table></figure>
<p><strong>年份</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 推荐：SMALLINT UNSIGNED</span></span><br><span class="line"><span class="keyword">year</span> <span class="type">SMALLINT</span> UNSIGNED</span><br><span class="line"><span class="comment">-- 范围：0 ~ 65535，足够存储年份（1900-65535）</span></span><br><span class="line"><span class="comment">-- 比INT节省一半空间</span></span><br></pre></td></tr></table></figure>
<p><strong>数量（如库存、点赞数）</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 小数量（&lt; 65535）</span></span><br><span class="line">stock <span class="type">SMALLINT</span> UNSIGNED <span class="keyword">DEFAULT</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 中等数量（&lt; 1677万）</span></span><br><span class="line">view_count MEDIUMINT UNSIGNED <span class="keyword">DEFAULT</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 大数量（可能超过1677万）</span></span><br><span class="line">like_count <span class="type">INT</span> UNSIGNED <span class="keyword">DEFAULT</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<hr />
<h2 id="mysql字符串类型">1.3 MySQL字符串类型</h2>
<h3 id="定长字符串char">1.3.1 定长字符串：CHAR</h3>
<p><strong>CHAR(n)</strong> = 固定长度的字符串，n为字符数（1-255）</p>
<p><strong>特点</strong>：</p>
<ul>
<li>✅ 固定长度，存储效率高</li>
<li>✅ 适合存储长度固定的数据</li>
<li>❌ 浪费空间（如果实际数据小于n）</li>
</ul>
<p><strong>实际例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 适合用CHAR的场景</span></span><br><span class="line">country_code <span class="type">CHAR</span>(<span class="number">2</span>)        <span class="comment">-- 国家代码：CN, US, JP</span></span><br><span class="line">phone_code <span class="type">CHAR</span>(<span class="number">3</span>)          <span class="comment">-- 电话区号：010, 021</span></span><br><span class="line">status_code <span class="type">CHAR</span>(<span class="number">1</span>)          <span class="comment">-- 状态码：A, B, C</span></span><br></pre></td></tr></table></figure>
<h3 id="变长字符串varchar">1.3.2 变长字符串：VARCHAR</h3>
<p><strong>VARCHAR(n)</strong> =
可变长度的字符串，n为最大字符数（1-65535）</p>
<p><strong>特点</strong>：</p>
<ul>
<li>✅ 按实际长度存储，节省空间</li>
<li>✅ 适合存储长度不固定的数据</li>
<li>❌ 需要额外1-2字节存储长度信息</li>
</ul>
<p><strong>实际例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 适合用VARCHAR的场景</span></span><br><span class="line">name <span class="type">VARCHAR</span>(<span class="number">50</span>)             <span class="comment">-- 姓名：通常10-20个字符</span></span><br><span class="line">email <span class="type">VARCHAR</span>(<span class="number">100</span>)           <span class="comment">-- 邮箱：通常20-50个字符</span></span><br><span class="line">title <span class="type">VARCHAR</span>(<span class="number">200</span>)           <span class="comment">-- 标题：通常10-100个字符</span></span><br><span class="line">address <span class="type">VARCHAR</span>(<span class="number">255</span>)         <span class="comment">-- 地址：通常50-200个字符</span></span><br></pre></td></tr></table></figure>
<p><strong>VARCHAR长度选择原则</strong>：</p>
<table>
<thead>
<tr class="header">
<th>数据长度</th>
<th>推荐VARCHAR长度</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10-20字符</td>
<td>VARCHAR(50)</td>
<td>预留2-3倍空间，方便扩展</td>
</tr>
<tr class="even">
<td>20-50字符</td>
<td>VARCHAR(100)</td>
<td>预留2倍空间</td>
</tr>
<tr class="odd">
<td>50-100字符</td>
<td>VARCHAR(200)</td>
<td>预留2倍空间</td>
</tr>
<tr class="even">
<td>100-200字符</td>
<td>VARCHAR(255)</td>
<td>最大常用长度</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="mysql文本类型">1.4 MySQL文本类型</h2>
<h3 id="文本类型对比">1.4.1 文本类型对比</h3>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 27%" />
<col style="width: 27%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="header">
<th>类型</th>
<th>最大长度</th>
<th>存储空间</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>TINYTEXT</strong></td>
<td>255字符</td>
<td>1字节+实际长度</td>
<td>短文本、备注</td>
</tr>
<tr class="even">
<td><strong>TEXT</strong></td>
<td>65,535字符（64KB）</td>
<td>2字节+实际长度</td>
<td>文章内容、评论内容（常用）</td>
</tr>
<tr class="odd">
<td><strong>MEDIUMTEXT</strong></td>
<td>16,777,215字符（16MB）</td>
<td>3字节+实际长度</td>
<td>长文章、富文本内容</td>
</tr>
<tr class="even">
<td><strong>LONGTEXT</strong></td>
<td>4,294,967,295字符（4GB）</td>
<td>4字节+实际长度</td>
<td>超长文本、文档内容</td>
</tr>
</tbody>
</table>
<h3 id="实际选型例子-1">1.4.2 实际选型例子</h3>
<p><strong>文章摘要/简介</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 推荐：TINYTEXT或VARCHAR(255)</span></span><br><span class="line">summary TINYTEXT</span><br><span class="line"><span class="comment">-- 摘要通常100-200字符，TINYTEXT足够</span></span><br><span class="line"><span class="comment">-- 或者用VARCHAR(255)也可以</span></span><br></pre></td></tr></table></figure>
<p><strong>文章内容</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 推荐：TEXT</span></span><br><span class="line">content TEXT</span><br><span class="line"><span class="comment">-- 普通文章通常几千到几万字，TEXT（64KB）足够</span></span><br><span class="line"><span class="comment">-- 如果文章可能很长（如技术文档），用MEDIUMTEXT</span></span><br></pre></td></tr></table></figure>
<p><strong>富文本内容</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 推荐：MEDIUMTEXT</span></span><br><span class="line">rich_content MEDIUMTEXT</span><br><span class="line"><span class="comment">-- 富文本包含HTML标签，可能很长</span></span><br><span class="line"><span class="comment">-- 16MB足够存储大多数富文本内容</span></span><br></pre></td></tr></table></figure>
<p><strong>评论内容</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 推荐：TEXT</span></span><br><span class="line">comment TEXT</span><br><span class="line"><span class="comment">-- 评论通常几百到几千字，TEXT足够</span></span><br><span class="line"><span class="comment">-- 如果评论可能很长，用MEDIUMTEXT</span></span><br></pre></td></tr></table></figure>
<p><strong>注意事项</strong>：</p>
<ul>
<li>❌
<strong>不要用VARCHAR存储长文本</strong>：VARCHAR最大65535字节，但实际受行大小限制</li>
<li>✅
<strong>不确定长度时，选大不选小</strong>：TEXT不够用再升级到MEDIUMTEXT</li>
<li>✅ <strong>TEXT类型不能设置默认值</strong>：MySQL不支持</li>
</ul>
<hr />
<h2 id="mysql日期时间类型">1.5 MySQL日期时间类型</h2>
<h3 id="日期时间类型对比">1.5.1 日期时间类型对比</h3>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>类型</th>
<th>格式</th>
<th>范围</th>
<th>存储空间</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>DATE</strong></td>
<td>YYYY-MM-DD</td>
<td>1000-01-01 ~ 9999-12-31</td>
<td>3字节</td>
<td>生日、日期</td>
</tr>
<tr class="even">
<td><strong>TIME</strong></td>
<td>HH:MM:SS</td>
<td>-838:59:59 ~ 838:59:59</td>
<td>3字节</td>
<td>时间点</td>
</tr>
<tr class="odd">
<td><strong>DATETIME</strong></td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>1000-01-01 00:00:00 ~ 9999-12-31 23:59:59</td>
<td>8字节</td>
<td>创建时间、更新时间（常用）</td>
</tr>
<tr class="even">
<td><strong>TIMESTAMP</strong></td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>1970-01-01 00:00:00 ~ 2038-01-19 03:14:07</td>
<td>4字节</td>
<td>自动更新时间戳</td>
</tr>
<tr class="odd">
<td><strong>YEAR</strong></td>
<td>YYYY</td>
<td>1901 ~ 2155</td>
<td>1字节</td>
<td>年份（节省空间）</td>
</tr>
</tbody>
</table>
<h3 id="实际选型例子-2">1.5.2 实际选型例子</h3>
<p><strong>创建时间、更新时间</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 推荐：DATETIME</span></span><br><span class="line">created_at DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">updated_at DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或者用TIMESTAMP（更省空间，但范围有限）</span></span><br><span class="line">created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">updated_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br></pre></td></tr></table></figure>
<p><strong>生日</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 推荐：DATE</span></span><br><span class="line">birthday <span class="type">DATE</span></span><br><span class="line"><span class="comment">-- 只需要日期，不需要时间</span></span><br><span class="line"><span class="comment">-- 比DATETIME节省空间</span></span><br></pre></td></tr></table></figure>
<p><strong>年份</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 推荐：YEAR（如果只需要年份）</span></span><br><span class="line">publish_year <span class="keyword">YEAR</span></span><br><span class="line"><span class="comment">-- 只需要年份时，用YEAR最省空间（1字节）</span></span><br><span class="line"><span class="comment">-- 或者用SMALLINT UNSIGNED也可以</span></span><br></pre></td></tr></table></figure>
<p><strong>DATETIME vs TIMESTAMP</strong>：</p>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>DATETIME</th>
<th>TIMESTAMP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>范围</strong></td>
<td>1000-9999年</td>
<td>1970-2038年</td>
</tr>
<tr class="even">
<td><strong>存储空间</strong></td>
<td>8字节</td>
<td>4字节</td>
</tr>
<tr class="odd">
<td><strong>时区</strong></td>
<td>不涉及时区</td>
<td>自动转换时区</td>
</tr>
<tr class="even">
<td><strong>推荐</strong></td>
<td>✅ 大多数场景</td>
<td>⚠️ 需要时区转换时</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="mysql其他常用类型">1.6 MySQL其他常用类型</h2>
<h3 id="布尔类型">1.6.1 布尔类型</h3>
<p><strong>BOOLEAN / BOOL</strong> = TINYINT(1)的别名</p>
<p><strong>实际例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 推荐：TINYINT(1)或BOOLEAN</span></span><br><span class="line">is_deleted TINYINT(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span>  <span class="comment">-- 0=未删除，1=已删除</span></span><br><span class="line">is_active <span class="type">BOOLEAN</span> <span class="keyword">DEFAULT</span> <span class="literal">TRUE</span>  <span class="comment">-- TRUE=1，FALSE=0</span></span><br><span class="line">completed TINYINT(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span>  <span class="comment">-- 0=未完成，1=已完成</span></span><br></pre></td></tr></table></figure>
<h3 id="浮点数类型">1.6.2 浮点数类型</h3>
<table>
<thead>
<tr class="header">
<th>类型</th>
<th>精度</th>
<th>存储空间</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>FLOAT</strong></td>
<td>单精度</td>
<td>4字节</td>
<td>一般精度要求不高的浮点数</td>
</tr>
<tr class="even">
<td><strong>DOUBLE</strong></td>
<td>双精度</td>
<td>8字节</td>
<td>高精度浮点数（常用）</td>
</tr>
<tr class="odd">
<td><strong>DECIMAL(M,D)</strong></td>
<td>精确小数</td>
<td>变长</td>
<td>金额、价格（必须精确）</td>
</tr>
</tbody>
</table>
<p><strong>实际例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 价格、金额：必须用DECIMAL</span></span><br><span class="line">price <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>)  <span class="comment">-- 总长度10位，小数2位，如：99999999.99</span></span><br><span class="line">amount <span class="type">DECIMAL</span>(<span class="number">15</span>, <span class="number">2</span>) <span class="comment">-- 总长度15位，小数2位</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ⚠️ 一般浮点数：用DOUBLE</span></span><br><span class="line">score <span class="keyword">DOUBLE</span>          <span class="comment">-- 分数：可能有小数</span></span><br><span class="line">rate <span class="keyword">DOUBLE</span>           <span class="comment">-- 比率：可能有小数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 不要用FLOAT/DOUBLE存储金额</span></span><br><span class="line"><span class="comment">-- 因为浮点数有精度问题，可能导致计算错误</span></span><br></pre></td></tr></table></figure>
<h3 id="json类型">1.6.3 JSON类型</h3>
<p><strong>JSON</strong> = 存储JSON格式的数据（MySQL 5.7+）</p>
<p><strong>实际例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 适合存储灵活的配置、扩展字段</span></span><br><span class="line">config JSON           <span class="comment">-- 配置信息：&#123;&quot;theme&quot;: &quot;dark&quot;, &quot;lang&quot;: &quot;zh&quot;&#125;</span></span><br><span class="line">metadata JSON         <span class="comment">-- 元数据：&#123;&quot;tags&quot;: [&quot;tag1&quot;, &quot;tag2&quot;], &quot;views&quot;: 100&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意事项</strong>：</p>
<ul>
<li>✅ 适合存储结构不固定的数据</li>
<li>❌ 不适合频繁查询的字段（查询性能较差）</li>
<li>✅
可以用JSON函数查询：<code>JSON_EXTRACT(config, '$.theme')</code></li>
</ul>
<hr />
<h2 id="实际例子博客系统表设计">1.7 实际例子：博客系统表设计</h2>
<p><strong>用户表（users）</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,  <span class="comment">-- 用户ID，INT足够</span></span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,        <span class="comment">-- 用户名，50字符足够</span></span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,          <span class="comment">-- 邮箱，100字符足够</span></span><br><span class="line">    password <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT NULL</span>,              <span class="comment">-- 密码（加密后），255字符</span></span><br><span class="line">    age TINYINT UNSIGNED,                        <span class="comment">-- 年龄，0-255足够</span></span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,                  <span class="comment">-- 状态：0=禁用，1=正常，2=删除</span></span><br><span class="line">    created_at DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    updated_at DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>文章表（articles）</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> articles (</span><br><span class="line">    id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,  <span class="comment">-- 文章ID</span></span><br><span class="line">    title <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT NULL</span>,                 <span class="comment">-- 标题，200字符足够</span></span><br><span class="line">    summary TINYTEXT,                            <span class="comment">-- 摘要，255字符足够</span></span><br><span class="line">    content TEXT <span class="keyword">NOT NULL</span>,                       <span class="comment">-- 内容，64KB足够大多数文章</span></span><br><span class="line">    author_id <span class="type">INT</span> UNSIGNED <span class="keyword">NOT NULL</span>,             <span class="comment">-- 作者ID，关联users表</span></span><br><span class="line">    view_count <span class="type">INT</span> UNSIGNED <span class="keyword">DEFAULT</span> <span class="number">0</span>,           <span class="comment">-- 浏览量，可能很大，用INT</span></span><br><span class="line">    like_count <span class="type">INT</span> UNSIGNED <span class="keyword">DEFAULT</span> <span class="number">0</span>,           <span class="comment">-- 点赞数，可能很大，用INT</span></span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,                    <span class="comment">-- 状态：0=草稿，1=发布，2=删除</span></span><br><span class="line">    created_at DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    updated_at DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (author_id) <span class="keyword">REFERENCES</span> users(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>评论表（comments）</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> comments (</span><br><span class="line">    id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    article_id <span class="type">INT</span> UNSIGNED <span class="keyword">NOT NULL</span>,            <span class="comment">-- 文章ID</span></span><br><span class="line">    user_id <span class="type">INT</span> UNSIGNED <span class="keyword">NOT NULL</span>,               <span class="comment">-- 用户ID</span></span><br><span class="line">    content TEXT <span class="keyword">NOT NULL</span>,                       <span class="comment">-- 评论内容，TEXT足够</span></span><br><span class="line">    like_count <span class="type">SMALLINT</span> UNSIGNED <span class="keyword">DEFAULT</span> <span class="number">0</span>,      <span class="comment">-- 点赞数，通常不会太大，用SMALLINT</span></span><br><span class="line">    is_deleted TINYINT(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="number">0</span>,            <span class="comment">-- 是否删除，布尔值</span></span><br><span class="line">    created_at DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (article_id) <span class="keyword">REFERENCES</span> articles(id),</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="数据类型选择总结">1.8 数据类型选择总结</h2>
<p><strong>选择原则</strong>：</p>
<ol type="1">
<li><strong>够用即可</strong>：不要选择过大的类型，浪费空间</li>
<li><strong>留有余地</strong>：不要选择过小的类型，避免后续扩展困难</li>
<li><strong>考虑性能</strong>：数据类型越小，查询越快</li>
<li><strong>考虑业务</strong>：根据实际业务需求选择</li>
</ol>
<p><strong>快速参考表</strong>：</p>
<table>
<thead>
<tr class="header">
<th>数据</th>
<th>推荐类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>主键ID</td>
<td>INT UNSIGNED</td>
<td>大多数场景足够</td>
</tr>
<tr class="even">
<td>年龄</td>
<td>TINYINT UNSIGNED</td>
<td>0-255足够</td>
</tr>
<tr class="odd">
<td>状态码</td>
<td>TINYINT</td>
<td>-128~127足够</td>
</tr>
<tr class="even">
<td>年份</td>
<td>YEAR或SMALLINT UNSIGNED</td>
<td>YEAR最省空间</td>
</tr>
<tr class="odd">
<td>姓名</td>
<td>VARCHAR(50)</td>
<td>预留2-3倍空间</td>
</tr>
<tr class="even">
<td>邮箱</td>
<td>VARCHAR(100)</td>
<td>通常20-50字符</td>
</tr>
<tr class="odd">
<td>标题</td>
<td>VARCHAR(200)</td>
<td>通常10-100字符</td>
</tr>
<tr class="even">
<td>短文本</td>
<td>TINYTEXT</td>
<td>&lt; 255字符</td>
</tr>
<tr class="odd">
<td>文章内容</td>
<td>TEXT</td>
<td>大多数文章足够</td>
</tr>
<tr class="even">
<td>长文章</td>
<td>MEDIUMTEXT</td>
<td>超长文章</td>
</tr>
<tr class="odd">
<td>创建时间</td>
<td>DATETIME</td>
<td>常用</td>
</tr>
<tr class="even">
<td>生日</td>
<td>DATE</td>
<td>只需要日期</td>
</tr>
<tr class="odd">
<td>价格</td>
<td>DECIMAL(10,2)</td>
<td>必须精确</td>
</tr>
<tr class="even">
<td>是否删除</td>
<td>TINYINT(1)</td>
<td>布尔值</td>
</tr>
</tbody>
</table>
<hr />
<h1 id="api实现">2. API实现</h1>
<h2 id="为什么需要后端api">2.1 为什么需要后端API？</h2>
<p><strong>前端和后端的分工</strong>：</p>
<table>
<thead>
<tr class="header">
<th>角色</th>
<th>职责</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>前端</strong></td>
<td>展示界面，处理用户交互</td>
</tr>
<tr class="even">
<td><strong>后端</strong></td>
<td>处理业务逻辑，操作数据库</td>
</tr>
</tbody>
</table>
<p><strong>实际例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">用户在前端点击&quot;发布文章&quot;按钮：</span><br><span class="line">1. 前端：收集表单数据（标题、内容）</span><br><span class="line">2. 前端：发送请求到后端API（POST /api/articles）</span><br><span class="line">3. 后端：验证数据（标题不能为空）</span><br><span class="line">4. 后端：保存到数据库</span><br><span class="line">5. 后端：返回结果给前端</span><br><span class="line">6. 前端：显示成功提示</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="使用fastapi实现crud接口">2.2 使用FastAPI实现CRUD接口</h2>
<h3 id="fastapi简介">2.2.1 FastAPI简介</h3>
<p><strong>FastAPI</strong> = 一个现代的Python
Web框架，用于快速构建API</p>
<p><strong>特点</strong>：</p>
<ul>
<li>✅ 简单易学：代码简洁，容易理解</li>
<li>✅ 自动文档：自动生成API文档</li>
<li>✅ 性能好：运行速度快</li>
</ul>
<h3 id="创建fastapi项目">2.2.2 创建FastAPI项目</h3>
<p><strong>基本结构</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建FastAPI应用</span></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义路由</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_root</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行应用</span></span><br><span class="line"><span class="comment"># uvicorn main:app --reload</span></span><br></pre></td></tr></table></figure>
<h3 id="实现crud接口">2.2.3 实现CRUD接口</h3>
<p><strong>实际例子</strong>：实现用户管理的CRUD接口</p>
<p><strong>1. 创建用户（Create）</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, HTTPException</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义数据模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserCreate</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    email: <span class="built_in">str</span></span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserResponse</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">int</span></span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    email: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟数据库（实际项目中应该用真实数据库）</span></span><br><span class="line">users_db = []</span><br><span class="line">next_id = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建用户</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/api/users&quot;</span>, response_model=UserResponse</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">user: UserCreate</span>):</span><br><span class="line">    <span class="keyword">global</span> next_id</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查邮箱是否已存在</span></span><br><span class="line">    <span class="keyword">for</span> u <span class="keyword">in</span> users_db:</span><br><span class="line">        <span class="keyword">if</span> u[<span class="string">&quot;email&quot;</span>] == user.email:</span><br><span class="line">            <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;邮箱已存在&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建新用户</span></span><br><span class="line">    new_user = &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: next_id,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: user.name,</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: user.email,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: user.password  <span class="comment"># 实际项目中应该加密</span></span><br><span class="line">    &#125;</span><br><span class="line">    users_db.append(new_user)</span><br><span class="line">    next_id += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> new_user</span><br></pre></td></tr></table></figure>
<p><strong>2. 获取用户列表（Read - 列表）</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取用户列表</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/api/users&quot;</span>, response_model=<span class="type">List</span>[UserResponse]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_users</span>():</span><br><span class="line">    <span class="keyword">return</span> users_db</span><br></pre></td></tr></table></figure>
<p><strong>3. 获取单个用户（Read - 详情）</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取单个用户</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/api/users/&#123;user_id&#125;&quot;</span>, response_model=UserResponse</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user</span>(<span class="params">user_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="comment"># 查找用户</span></span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> users_db:</span><br><span class="line">        <span class="keyword">if</span> user[<span class="string">&quot;id&quot;</span>] == user_id:</span><br><span class="line">            <span class="keyword">return</span> user</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 用户不存在</span></span><br><span class="line">    <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">&quot;用户不存在&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>4. 更新用户（Update）</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserUpdate</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span> = <span class="literal">None</span></span><br><span class="line">    email: <span class="built_in">str</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新用户</span></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/api/users/&#123;user_id&#125;&quot;</span>, response_model=UserResponse</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_user</span>(<span class="params">user_id: <span class="built_in">int</span>, user_update: UserUpdate</span>):</span><br><span class="line">    <span class="comment"># 查找用户</span></span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> users_db:</span><br><span class="line">        <span class="keyword">if</span> user[<span class="string">&quot;id&quot;</span>] == user_id:</span><br><span class="line">            <span class="comment"># 更新字段</span></span><br><span class="line">            <span class="keyword">if</span> user_update.name:</span><br><span class="line">                user[<span class="string">&quot;name&quot;</span>] = user_update.name</span><br><span class="line">            <span class="keyword">if</span> user_update.email:</span><br><span class="line">                user[<span class="string">&quot;email&quot;</span>] = user_update.email</span><br><span class="line">            <span class="keyword">return</span> user</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 用户不存在</span></span><br><span class="line">    <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">&quot;用户不存在&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>5. 删除用户（Delete）</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除用户</span></span><br><span class="line"><span class="meta">@app.delete(<span class="params"><span class="string">&quot;/api/users/&#123;user_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_user</span>(<span class="params">user_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="comment"># 查找用户</span></span><br><span class="line">    <span class="keyword">for</span> i, user <span class="keyword">in</span> <span class="built_in">enumerate</span>(users_db):</span><br><span class="line">        <span class="keyword">if</span> user[<span class="string">&quot;id&quot;</span>] == user_id:</span><br><span class="line">            users_db.pop(i)</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;删除成功&quot;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 用户不存在</span></span><br><span class="line">    <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">&quot;用户不存在&quot;</span>)</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="接口测试">2.3 接口测试</h2>
<h3 id="启动服务">2.3.1 启动服务</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装FastAPI</span></span><br><span class="line">pip install fastapi uvicorn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">uvicorn main:app --reload</span><br></pre></td></tr></table></figure>
<h3 id="使用apifox测试">2.3.2 使用APIFox测试</h3>
<p><strong>测试创建用户</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">方法：POST</span><br><span class="line">URL：http://localhost:8000/api/users</span><br><span class="line">请求体（JSON）：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;张三&quot;,</span><br><span class="line">  &quot;email&quot;: &quot;zhangsan@example.com&quot;,</span><br><span class="line">  &quot;password&quot;: &quot;123456&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>测试获取用户列表</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">方法：GET</span><br><span class="line">URL：http://localhost:8000/api/users</span><br></pre></td></tr></table></figure>
<p><strong>测试获取单个用户</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">方法：GET</span><br><span class="line">URL：http://localhost:8000/api/users/1</span><br></pre></td></tr></table></figure>
<p><strong>测试更新用户</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">方法：PUT</span><br><span class="line">URL：http://localhost:8000/api/users/1</span><br><span class="line">请求体（JSON）：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;张三（已更新）&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>测试删除用户</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">方法：DELETE</span><br><span class="line">URL：http://localhost:8000/api/users/1</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="连接真实数据库">2.4 连接真实数据库</h2>
<h3 id="使用sqlalchemy">2.4.1 使用SQLAlchemy</h3>
<p><strong>SQLAlchemy</strong> =
Python的数据库ORM工具，可以方便地操作数据库</p>
<p><strong>安装</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install sqlalchemy</span><br></pre></td></tr></table></figure>
<p><strong>基本使用</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine, Column, Integer, String</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数据库连接</span></span><br><span class="line">DATABASE_URL = <span class="string">&quot;sqlite:///./test.db&quot;</span>  <span class="comment"># SQLite数据库</span></span><br><span class="line">engine = create_engine(DATABASE_URL)</span><br><span class="line">SessionLocal = sessionmaker(autocommit=<span class="literal">False</span>, autoflush=<span class="literal">False</span>, bind=engine)</span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义数据模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    __tablename__ = <span class="string">&quot;users&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">id</span> = Column(Integer, primary_key=<span class="literal">True</span>, index=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">50</span>))</span><br><span class="line">    email = Column(String(<span class="number">100</span>), unique=<span class="literal">True</span>, index=<span class="literal">True</span>)</span><br><span class="line">    password = Column(String(<span class="number">255</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建表</span></span><br><span class="line">Base.metadata.create_all(bind=engine)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用数据库</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_db</span>():</span><br><span class="line">    db = SessionLocal()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> db</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        db.close()</span><br></pre></td></tr></table></figure>
<h3 id="使用数据库的crud接口">2.4.2 使用数据库的CRUD接口</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> Session</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建用户（使用数据库）</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/api/users&quot;</span>, response_model=UserResponse</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">user: UserCreate, db: Session = Depends(<span class="params">get_db</span>)</span>):</span><br><span class="line">    <span class="comment"># 检查邮箱是否已存在</span></span><br><span class="line">    db_user = db.query(User).<span class="built_in">filter</span>(User.email == user.email).first()</span><br><span class="line">    <span class="keyword">if</span> db_user:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;邮箱已存在&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建新用户</span></span><br><span class="line">    db_user = User(</span><br><span class="line">        name=user.name,</span><br><span class="line">        email=user.email,</span><br><span class="line">        password=user.password</span><br><span class="line">    )</span><br><span class="line">    db.add(db_user)</span><br><span class="line">    db.commit()</span><br><span class="line">    db.refresh(db_user)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> db_user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取用户列表（使用数据库）</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/api/users&quot;</span>, response_model=<span class="type">List</span>[UserResponse]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_users</span>(<span class="params">db: Session = Depends(<span class="params">get_db</span>)</span>):</span><br><span class="line">    users = db.query(User).<span class="built_in">all</span>()</span><br><span class="line">    <span class="keyword">return</span> users</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="接口设计要点">2.5 接口设计要点</h2>
<h3 id="统一响应格式">2.5.1 统一响应格式</h3>
<p><strong>标准响应格式</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;code&quot;</span>: <span class="number">200</span>,        <span class="comment"># 状态码</span></span><br><span class="line">    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;成功&quot;</span>,   <span class="comment"># 提示信息</span></span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123; ... &#125;     <span class="comment"># 数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>实际例子</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 成功响应</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;code&quot;</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;创建成功&quot;</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;zhangsan@example.com&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误响应</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;code&quot;</span>: <span class="number">400</span>,</span><br><span class="line">    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;邮箱已存在&quot;</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="错误处理">2.5.2 错误处理</h3>
<p><strong>常见错误</strong>：</p>
<table>
<thead>
<tr class="header">
<th>错误类型</th>
<th>HTTP状态码</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>参数错误</td>
<td>400</td>
<td>请求参数不正确</td>
</tr>
<tr class="even">
<td>未授权</td>
<td>401</td>
<td>未登录或Token无效</td>
</tr>
<tr class="odd">
<td>禁止访问</td>
<td>403</td>
<td>没有权限</td>
</tr>
<tr class="even">
<td>资源不存在</td>
<td>404</td>
<td>请求的资源不存在</td>
</tr>
<tr class="odd">
<td>服务器错误</td>
<td>500</td>
<td>服务器内部错误</td>
</tr>
</tbody>
</table>
<p><strong>实际例子</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户不存在</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">    <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">&quot;用户不存在&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 邮箱已存在</span></span><br><span class="line"><span class="keyword">if</span> db.query(User).<span class="built_in">filter</span>(User.email == email).first():</span><br><span class="line">    <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;邮箱已存在&quot;</span>)</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="实际例子待办事项api">2.6 实际例子：待办事项API</h2>
<p><strong>完整的待办事项CRUD接口</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, HTTPException</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TodoCreate</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    title: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TodoUpdate</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    title: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line">    completed: <span class="type">Optional</span>[<span class="built_in">bool</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TodoResponse</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">int</span></span><br><span class="line">    title: <span class="built_in">str</span></span><br><span class="line">    completed: <span class="built_in">bool</span></span><br><span class="line">    created_at: datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟数据库</span></span><br><span class="line">todos_db = []</span><br><span class="line">next_id = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建待办事项</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/api/todos&quot;</span>, response_model=TodoResponse</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_todo</span>(<span class="params">todo: TodoCreate</span>):</span><br><span class="line">    <span class="keyword">global</span> next_id</span><br><span class="line">    new_todo = &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: next_id,</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: todo.title,</span><br><span class="line">        <span class="string">&quot;completed&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&quot;created_at&quot;</span>: datetime.now()</span><br><span class="line">    &#125;</span><br><span class="line">    todos_db.append(new_todo)</span><br><span class="line">    next_id += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> new_todo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取待办事项列表</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/api/todos&quot;</span>, response_model=<span class="type">List</span>[TodoResponse]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_todos</span>():</span><br><span class="line">    <span class="keyword">return</span> todos_db</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取单个待办事项</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/api/todos/&#123;todo_id&#125;&quot;</span>, response_model=TodoResponse</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_todo</span>(<span class="params">todo_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">for</span> todo <span class="keyword">in</span> todos_db:</span><br><span class="line">        <span class="keyword">if</span> todo[<span class="string">&quot;id&quot;</span>] == todo_id:</span><br><span class="line">            <span class="keyword">return</span> todo</span><br><span class="line">    <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">&quot;待办事项不存在&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新待办事项</span></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/api/todos/&#123;todo_id&#125;&quot;</span>, response_model=TodoResponse</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_todo</span>(<span class="params">todo_id: <span class="built_in">int</span>, todo_update: TodoUpdate</span>):</span><br><span class="line">    <span class="keyword">for</span> todo <span class="keyword">in</span> todos_db:</span><br><span class="line">        <span class="keyword">if</span> todo[<span class="string">&quot;id&quot;</span>] == todo_id:</span><br><span class="line">            <span class="keyword">if</span> todo_update.title:</span><br><span class="line">                todo[<span class="string">&quot;title&quot;</span>] = todo_update.title</span><br><span class="line">            <span class="keyword">if</span> todo_update.completed <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                todo[<span class="string">&quot;completed&quot;</span>] = todo_update.completed</span><br><span class="line">            <span class="keyword">return</span> todo</span><br><span class="line">    <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">&quot;待办事项不存在&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除待办事项</span></span><br><span class="line"><span class="meta">@app.delete(<span class="params"><span class="string">&quot;/api/todos/&#123;todo_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_todo</span>(<span class="params">todo_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">for</span> i, todo <span class="keyword">in</span> <span class="built_in">enumerate</span>(todos_db):</span><br><span class="line">        <span class="keyword">if</span> todo[<span class="string">&quot;id&quot;</span>] == todo_id:</span><br><span class="line">            todos_db.pop(i)</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;删除成功&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">&quot;待办事项不存在&quot;</span>)</span><br></pre></td></tr></table></figure>
<hr />
<blockquote>
<p>💡 <strong>关键理解</strong>：<br />
后端API的核心就是实现CRUD操作，将前端请求转换为数据库操作，并返回结果。<br />
掌握了CRUD接口的实现，就掌握了后端开发的基础！</p>
</blockquote>
<hr />
<h1 id="数据验证">3. 数据验证</h1>
<h2 id="为什么需要数据验证">3.1 为什么需要数据验证？</h2>
<p><strong>问题</strong>：前端传来的数据一定正确吗？</p>
<p><strong>实际情况</strong>：</p>
<ul>
<li>❌ 用户可能输入错误的数据</li>
<li>❌ 前端可能被绕过（直接调用API）</li>
<li>❌ 恶意用户可能发送恶意数据</li>
</ul>
<p><strong>生活类比</strong>：</p>
<ul>
<li><strong>没有验证</strong>：任何人都能进入，不安全</li>
<li><strong>有验证</strong>：检查身份和权限，安全可靠</li>
</ul>
<p><strong>实际例子</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ❌ 没有验证的接口</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/api/users&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">user: <span class="built_in">dict</span></span>):</span><br><span class="line">    <span class="comment"># 直接保存，可能有问题</span></span><br><span class="line">    save_user(user)  <span class="comment"># 如果user没有name字段怎么办？</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ✅ 有验证的接口</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/api/users&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">user: UserCreate</span>):</span><br><span class="line">    <span class="comment"># Pydantic自动验证，确保数据正确</span></span><br><span class="line">    save_user(user)  <span class="comment"># 如果数据不对，会自动报错</span></span><br></pre></td></tr></table></figure>
<hr />
<h2 id="使用pydantic进行数据验证">3.2 使用Pydantic进行数据验证</h2>
<h3 id="pydantic简介">3.2.1 Pydantic简介</h3>
<p><strong>Pydantic</strong> = Python的数据验证库，FastAPI内置支持</p>
<p><strong>特点</strong>：</p>
<ul>
<li>✅ 自动验证数据类型</li>
<li>✅ 自动验证数据格式</li>
<li>✅ 自动生成错误信息</li>
<li>✅ 代码简洁易读</li>
</ul>
<h3 id="基本验证">3.2.2 基本验证</h3>
<p><strong>定义数据模型</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, EmailStr</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserCreate</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span>                    <span class="comment"># 必填，字符串类型</span></span><br><span class="line">    email: EmailStr              <span class="comment"># 必填，必须是邮箱格式</span></span><br><span class="line">    age: <span class="type">Optional</span>[<span class="built_in">int</span>] = <span class="literal">None</span>    <span class="comment"># 可选，整数类型</span></span><br><span class="line">    password: <span class="built_in">str</span>                <span class="comment"># 必填，字符串类型</span></span><br></pre></td></tr></table></figure>
<p><strong>自动验证</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ✅ 正确的数据</span></span><br><span class="line">user = UserCreate(</span><br><span class="line">    name=<span class="string">&quot;张三&quot;</span>,</span><br><span class="line">    email=<span class="string">&quot;zhangsan@example.com&quot;</span>,</span><br><span class="line">    age=<span class="number">20</span>,</span><br><span class="line">    password=<span class="string">&quot;123456&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ❌ 错误的数据（会自动报错）</span></span><br><span class="line">user = UserCreate(</span><br><span class="line">    name=<span class="string">&quot;张三&quot;</span>,</span><br><span class="line">    email=<span class="string">&quot;not-an-email&quot;</span>,  <span class="comment"># 不是邮箱格式，会报错</span></span><br><span class="line">    age=<span class="string">&quot;20&quot;</span>               <span class="comment"># 不是整数，会报错</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="常用验证规则">3.3 常用验证规则</h2>
<h3 id="字符串验证">3.3.1 字符串验证</h3>
<p><strong>长度限制</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserCreate</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span> = Field(..., min_length=<span class="number">2</span>, max_length=<span class="number">50</span>)</span><br><span class="line">    <span class="comment"># ... 表示必填</span></span><br><span class="line">    <span class="comment"># min_length=2：最少2个字符</span></span><br><span class="line">    <span class="comment"># max_length=50：最多50个字符</span></span><br><span class="line">    </span><br><span class="line">    email: <span class="built_in">str</span> = Field(..., min_length=<span class="number">5</span>, max_length=<span class="number">100</span>)</span><br><span class="line">    password: <span class="built_in">str</span> = Field(..., min_length=<span class="number">6</span>, max_length=<span class="number">20</span>)</span><br></pre></td></tr></table></figure>
<p><strong>正则表达式验证</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field, validator</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserCreate</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span> = Field(..., min_length=<span class="number">3</span>, max_length=<span class="number">20</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @validator(<span class="params"><span class="string">&#x27;username&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_username</span>(<span class="params">cls, v</span>):</span><br><span class="line">        <span class="comment"># 只能包含字母、数字、下划线</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(<span class="string">r&#x27;^[a-zA-Z0-9_]+$&#x27;</span>, v):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;用户名只能包含字母、数字、下划线&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> v</span><br></pre></td></tr></table></figure>
<h3 id="数字验证">3.3.2 数字验证</h3>
<p><strong>范围限制</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserCreate</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    age: <span class="built_in">int</span> = Field(..., ge=<span class="number">0</span>, le=<span class="number">150</span>)</span><br><span class="line">    <span class="comment"># ge=0：大于等于0</span></span><br><span class="line">    <span class="comment"># le=150：小于等于150</span></span><br><span class="line">    </span><br><span class="line">    score: <span class="built_in">float</span> = Field(..., gt=<span class="number">0</span>, lt=<span class="number">100</span>)</span><br><span class="line">    <span class="comment"># gt=0：大于0</span></span><br><span class="line">    <span class="comment"># lt=100：小于100</span></span><br></pre></td></tr></table></figure>
<h3 id="邮箱验证">3.3.3 邮箱验证</h3>
<p><strong>使用EmailStr</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, EmailStr</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserCreate</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    email: EmailStr  <span class="comment"># 自动验证邮箱格式</span></span><br></pre></td></tr></table></figure>
<h3 id="枚举验证">3.3.4 枚举验证</h3>
<p><strong>限制可选值</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserStatus</span>(<span class="built_in">str</span>, Enum):</span><br><span class="line">    ACTIVE = <span class="string">&quot;active&quot;</span>      <span class="comment"># 激活</span></span><br><span class="line">    INACTIVE = <span class="string">&quot;inactive&quot;</span>  <span class="comment"># 未激活</span></span><br><span class="line">    DELETED = <span class="string">&quot;deleted&quot;</span>    <span class="comment"># 已删除</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserCreate</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    status: UserStatus = UserStatus.ACTIVE  <span class="comment"># 默认值</span></span><br></pre></td></tr></table></figure>
<hr />
<h2 id="实际例子用户注册验证">3.4 实际例子：用户注册验证</h2>
<p><strong>完整的用户注册接口</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, HTTPException</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, EmailStr, Field, validator</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserRegister</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span> = Field(</span><br><span class="line">        ..., </span><br><span class="line">        min_length=<span class="number">3</span>, </span><br><span class="line">        max_length=<span class="number">20</span>,</span><br><span class="line">        description=<span class="string">&quot;用户名，3-20个字符&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    email: EmailStr = Field(</span><br><span class="line">        ...,</span><br><span class="line">        description=<span class="string">&quot;邮箱地址&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    password: <span class="built_in">str</span> = Field(</span><br><span class="line">        ...,</span><br><span class="line">        min_length=<span class="number">6</span>,</span><br><span class="line">        max_length=<span class="number">20</span>,</span><br><span class="line">        description=<span class="string">&quot;密码，6-20个字符&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    age: <span class="type">Optional</span>[<span class="built_in">int</span>] = Field(</span><br><span class="line">        <span class="literal">None</span>,</span><br><span class="line">        ge=<span class="number">0</span>,</span><br><span class="line">        le=<span class="number">150</span>,</span><br><span class="line">        description=<span class="string">&quot;年龄，0-150&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @validator(<span class="params"><span class="string">&#x27;username&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_username</span>(<span class="params">cls, v</span>):</span><br><span class="line">        <span class="comment"># 只能包含字母、数字、下划线</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(<span class="string">r&#x27;^[a-zA-Z0-9_]+$&#x27;</span>, v):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;用户名只能包含字母、数字、下划线&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> v</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @validator(<span class="params"><span class="string">&#x27;password&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_password</span>(<span class="params">cls, v</span>):</span><br><span class="line">        <span class="comment"># 密码必须包含至少一个数字和一个字母</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(<span class="string">r&#x27;[0-9]&#x27;</span>, v):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;密码必须包含至少一个数字&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.search(<span class="string">r&#x27;[a-zA-Z]&#x27;</span>, v):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;密码必须包含至少一个字母&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/api/users/register&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register_user</span>(<span class="params">user: UserRegister</span>):</span><br><span class="line">    <span class="comment"># 数据已经通过验证，可以直接使用</span></span><br><span class="line">    <span class="comment"># 检查用户名是否已存在（这里简化处理）</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;code&quot;</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;注册成功&quot;</span>,</span><br><span class="line">        <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: user.username,</span><br><span class="line">            <span class="string">&quot;email&quot;</span>: user.email</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>测试</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ✅ 正确的数据</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;zhangsan&quot;</span>,</span><br><span class="line">    <span class="string">&quot;email&quot;</span>: <span class="string">&quot;zhangsan@example.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;abc123&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ❌ 错误的数据（会自动返回验证错误）</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;zh&quot;</span>,  <span class="comment"># 太短，少于3个字符</span></span><br><span class="line">    <span class="string">&quot;email&quot;</span>: <span class="string">&quot;not-email&quot;</span>,  <span class="comment"># 不是邮箱格式</span></span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123&quot;</span>,  <span class="comment"># 太短，少于6个字符</span></span><br><span class="line">    <span class="string">&quot;age&quot;</span>: <span class="number">200</span>  <span class="comment"># 超过150</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="验证错误处理">3.5 验证错误处理</h2>
<h3 id="fastapi自动处理验证错误">3.5.1 FastAPI自动处理验证错误</h3>
<p><strong>当数据验证失败时，FastAPI会自动返回错误信息</strong>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;detail&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;body&quot;</span><span class="punctuation">,</span> <span class="string">&quot;email&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value is not a valid email address&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value_error.email&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;loc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;body&quot;</span><span class="punctuation">,</span> <span class="string">&quot;password&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ensure this value has at least 6 characters&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;value_error.any_str.min_length&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="自定义错误信息">3.5.2 自定义错误信息</h3>
<p><strong>使用Field的description和自定义validator</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field, validator</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserCreate</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    password: <span class="built_in">str</span> = Field(</span><br><span class="line">        ...,</span><br><span class="line">        min_length=<span class="number">6</span>,</span><br><span class="line">        description=<span class="string">&quot;密码，至少6个字符&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @validator(<span class="params"><span class="string">&#x27;password&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_password</span>(<span class="params">cls, v</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(v) &lt; <span class="number">6</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;密码长度至少6个字符，请重新输入&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> v</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="实际例子文章发布验证">3.6 实际例子：文章发布验证</h2>
<p><strong>文章发布接口的完整验证</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field, validator</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArticleCreate</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    title: <span class="built_in">str</span> = Field(</span><br><span class="line">        ...,</span><br><span class="line">        min_length=<span class="number">1</span>,</span><br><span class="line">        max_length=<span class="number">200</span>,</span><br><span class="line">        description=<span class="string">&quot;文章标题，1-200个字符&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    content: <span class="built_in">str</span> = Field(</span><br><span class="line">        ...,</span><br><span class="line">        min_length=<span class="number">10</span>,</span><br><span class="line">        description=<span class="string">&quot;文章内容，至少10个字符&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    category: <span class="built_in">str</span> = Field(</span><br><span class="line">        ...,</span><br><span class="line">        description=<span class="string">&quot;文章分类&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    tags: <span class="type">Optional</span>[<span class="built_in">list</span>] = Field(</span><br><span class="line">        <span class="literal">None</span>,</span><br><span class="line">        description=<span class="string">&quot;标签列表&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @validator(<span class="params"><span class="string">&#x27;title&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_title</span>(<span class="params">cls, v</span>):</span><br><span class="line">        <span class="comment"># 标题不能全是空格</span></span><br><span class="line">        <span class="keyword">if</span> v.strip() == <span class="string">&quot;&quot;</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;标题不能为空&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> v.strip()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @validator(<span class="params"><span class="string">&#x27;content&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_content</span>(<span class="params">cls, v</span>):</span><br><span class="line">        <span class="comment"># 内容不能全是空格</span></span><br><span class="line">        <span class="keyword">if</span> v.strip() == <span class="string">&quot;&quot;</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;内容不能为空&#x27;</span>)</span><br><span class="line">        <span class="comment"># 内容不能太短</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(v.strip()) &lt; <span class="number">10</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;文章内容至少需要10个字符&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> v</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @validator(<span class="params"><span class="string">&#x27;tags&#x27;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_tags</span>(<span class="params">cls, v</span>):</span><br><span class="line">        <span class="keyword">if</span> v <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="comment"># 标签数量不能超过10个</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(v) &gt; <span class="number">10</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&#x27;标签数量不能超过10个&#x27;</span>)</span><br><span class="line">            <span class="comment"># 每个标签长度不能超过20个字符</span></span><br><span class="line">            <span class="keyword">for</span> tag <span class="keyword">in</span> v:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(tag) &gt; <span class="number">20</span>:</span><br><span class="line">                    <span class="keyword">raise</span> ValueError(<span class="string">&#x27;每个标签长度不能超过20个字符&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/api/articles&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_article</span>(<span class="params">article: ArticleCreate</span>):</span><br><span class="line">    <span class="comment"># 数据已经通过验证</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;code&quot;</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;发布成功&quot;</span>,</span><br><span class="line">        <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;title&quot;</span>: article.title,</span><br><span class="line">            <span class="string">&quot;category&quot;</span>: article.category,</span><br><span class="line">            <span class="string">&quot;created_at&quot;</span>: datetime.now()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="数据验证最佳实践">3.7 数据验证最佳实践</h2>
<p><strong>验证原则</strong>：</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>原则</th>
<th>说明</th>
<th>例子</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>前端验证 + 后端验证</strong></td>
<td>前端验证提升用户体验，后端验证保证安全</td>
<td>前端提示"密码太短"，后端拒绝无效数据</td>
</tr>
<tr class="even">
<td><strong>尽早验证</strong></td>
<td>在数据进入业务逻辑前就验证</td>
<td>在接口入口处验证，不要等到数据库操作时</td>
</tr>
<tr class="odd">
<td><strong>清晰的错误信息</strong></td>
<td>告诉用户哪里错了，怎么改</td>
<td>"密码至少6个字符"比"验证失败"更清晰</td>
</tr>
<tr class="even">
<td><strong>验证所有输入</strong></td>
<td>不要相信任何输入，都要验证</td>
<td>即使用户ID也要验证是否存在</td>
</tr>
</tbody>
</table>
<p><strong>实际例子</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ✅ 好的验证</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserCreate</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span> = Field(..., min_length=<span class="number">2</span>, max_length=<span class="number">50</span>, description=<span class="string">&quot;姓名，2-50个字符&quot;</span>)</span><br><span class="line">    email: EmailStr = Field(..., description=<span class="string">&quot;邮箱地址&quot;</span>)</span><br><span class="line">    age: <span class="built_in">int</span> = Field(..., ge=<span class="number">0</span>, le=<span class="number">150</span>, description=<span class="string">&quot;年龄，0-150&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ❌ 不好的验证</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserCreate</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span>  <span class="comment"># 没有长度限制</span></span><br><span class="line">    email: <span class="built_in">str</span>  <span class="comment"># 没有格式验证</span></span><br><span class="line">    age: <span class="built_in">int</span>    <span class="comment"># 没有范围限制</span></span><br></pre></td></tr></table></figure>
<hr />
<blockquote>
<p>💡 <strong>关键理解</strong>：<br />
数据验证是后端安全的第一道防线。<br />
永远不要相信前端传来的数据，必须在后端进行验证！</p>
</blockquote>
<hr />
<h1 id="ai实战使用ai实现excel导入导出">4.
AI实战：使用AI实现Excel导入导出</h1>
<h2 id="任务描述">4.1 任务描述</h2>
<p><strong>需求</strong>：实现一个Excel文件的导入导出功能</p>
<p><strong>功能要求</strong>：</p>
<ol type="1">
<li><strong>导入功能</strong>：上传Excel文件，解析数据并保存到数据库</li>
<li><strong>导出功能</strong>：从数据库查询数据，生成Excel文件并下载</li>
<li><strong>数据验证</strong>：导入时验证数据格式和内容</li>
</ol>
<p><strong>实际应用场景</strong>：</p>
<ul>
<li>批量导入用户数据</li>
<li>导出报表数据</li>
<li>数据备份和恢复</li>
</ul>
<hr />
<h2 id="第一步设计prompt">4.2 第一步：设计Prompt</h2>
<p><strong>给AI的Prompt</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">请帮我实现一个Excel导入导出功能，要求如下：</span><br><span class="line"></span><br><span class="line">1. 使用FastAPI框架</span><br><span class="line">2. 使用openpyxl库处理Excel文件</span><br><span class="line">3. 实现用户数据的导入和导出</span><br><span class="line"></span><br><span class="line">具体要求：</span><br><span class="line">- 导入：接收Excel文件，解析用户数据（姓名、邮箱、年龄），验证数据，保存到数据库</span><br><span class="line">- 导出：从数据库查询用户数据，生成Excel文件，返回文件下载</span><br><span class="line"></span><br><span class="line">数据格式：</span><br><span class="line">- Excel第一行是表头：姓名、邮箱、年龄</span><br><span class="line">- 从第二行开始是数据</span><br><span class="line"></span><br><span class="line">请提供完整的代码，包括：</span><br><span class="line">1. 数据模型定义</span><br><span class="line">2. 导入接口实现</span><br><span class="line">3. 导出接口实现</span><br><span class="line">4. 数据验证逻辑</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="ai生成的代码示例">4.3 AI生成的代码（示例）</h2>
<h3 id="安装依赖">4.3.1 安装依赖</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install fastapi uvicorn openpyxl python-multipart</span><br></pre></td></tr></table></figure>
<h3 id="完整代码实现">4.3.2 完整代码实现</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, UploadFile, File, HTTPException</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> FileResponse</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, EmailStr, Field, validator</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> Workbook, load_workbook</span><br><span class="line"><span class="keyword">from</span> openpyxl.styles <span class="keyword">import</span> Font, Alignment</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserImport</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span> = Field(..., min_length=<span class="number">1</span>, max_length=<span class="number">50</span>)</span><br><span class="line">    email: EmailStr</span><br><span class="line">    age: <span class="built_in">int</span> = Field(..., ge=<span class="number">0</span>, le=<span class="number">150</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserExport</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">int</span></span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    email: <span class="built_in">str</span></span><br><span class="line">    age: <span class="built_in">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟数据库（实际项目中应该用真实数据库）</span></span><br><span class="line">users_db = []</span><br><span class="line">next_id = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Excel导入接口</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/api/users/import&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">import_users</span>(<span class="params">file: UploadFile = File(<span class="params">...</span>)</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    导入用户数据</span></span><br><span class="line"><span class="string">    接收Excel文件，解析数据，验证并保存</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 检查文件类型</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> file.filename.endswith((<span class="string">&#x27;.xlsx&#x27;</span>, <span class="string">&#x27;.xls&#x27;</span>)):</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;只支持Excel文件（.xlsx, .xls）&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 读取Excel文件</span></span><br><span class="line">        contents = <span class="keyword">await</span> file.read()</span><br><span class="line">        workbook = load_workbook(io.BytesIO(contents))</span><br><span class="line">        sheet = workbook.active</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 验证表头</span></span><br><span class="line">        headers = [cell.value <span class="keyword">for</span> cell <span class="keyword">in</span> sheet[<span class="number">1</span>]]</span><br><span class="line">        expected_headers = [<span class="string">&#x27;姓名&#x27;</span>, <span class="string">&#x27;邮箱&#x27;</span>, <span class="string">&#x27;年龄&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> headers != expected_headers:</span><br><span class="line">            <span class="keyword">raise</span> HTTPException(</span><br><span class="line">                status_code=<span class="number">400</span>, </span><br><span class="line">                detail=<span class="string">f&quot;表头不正确，应为：<span class="subst">&#123;expected_headers&#125;</span>&quot;</span></span><br><span class="line">            )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 解析数据</span></span><br><span class="line">        imported_users = []</span><br><span class="line">        errors = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> row_idx, row <span class="keyword">in</span> <span class="built_in">enumerate</span>(sheet.iter_rows(min_row=<span class="number">2</span>, values_only=<span class="literal">True</span>), start=<span class="number">2</span>):</span><br><span class="line">            name, email, age = row</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 跳过空行</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> name <span class="keyword">and</span> <span class="keyword">not</span> email:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 验证数据</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 验证姓名</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> name <span class="keyword">or</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(name, <span class="built_in">str</span>) <span class="keyword">or</span> <span class="built_in">len</span>(name.strip()) == <span class="number">0</span>:</span><br><span class="line">                    errors.append(<span class="string">f&quot;第<span class="subst">&#123;row_idx&#125;</span>行：姓名为空&quot;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 验证邮箱</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> email <span class="keyword">or</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(email, <span class="built_in">str</span>):</span><br><span class="line">                    errors.append(<span class="string">f&quot;第<span class="subst">&#123;row_idx&#125;</span>行：邮箱格式错误&quot;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 验证年龄</span></span><br><span class="line">                <span class="keyword">if</span> age <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    errors.append(<span class="string">f&quot;第<span class="subst">&#123;row_idx&#125;</span>行：年龄为空&quot;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    age = <span class="built_in">int</span>(age)</span><br><span class="line">                    <span class="keyword">if</span> age &lt; <span class="number">0</span> <span class="keyword">or</span> age &gt; <span class="number">150</span>:</span><br><span class="line">                        errors.append(<span class="string">f&quot;第<span class="subst">&#123;row_idx&#125;</span>行：年龄必须在0-150之间&quot;</span>)</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">except</span> (ValueError, TypeError):</span><br><span class="line">                    errors.append(<span class="string">f&quot;第<span class="subst">&#123;row_idx&#125;</span>行：年龄必须是数字&quot;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 验证邮箱格式</span></span><br><span class="line">                email_pattern = <span class="string">r&#x27;^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]&#123;2,&#125;$&#x27;</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(email_pattern, email):</span><br><span class="line">                    errors.append(<span class="string">f&quot;第<span class="subst">&#123;row_idx&#125;</span>行：邮箱格式不正确&quot;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 检查邮箱是否已存在</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">any</span>(u[<span class="string">&quot;email&quot;</span>] == email <span class="keyword">for</span> u <span class="keyword">in</span> users_db):</span><br><span class="line">                    errors.append(<span class="string">f&quot;第<span class="subst">&#123;row_idx&#125;</span>行：邮箱已存在&quot;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 创建用户</span></span><br><span class="line">                <span class="keyword">global</span> next_id</span><br><span class="line">                new_user = &#123;</span><br><span class="line">                    <span class="string">&quot;id&quot;</span>: next_id,</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: name.strip(),</span><br><span class="line">                    <span class="string">&quot;email&quot;</span>: email.strip(),</span><br><span class="line">                    <span class="string">&quot;age&quot;</span>: age</span><br><span class="line">                &#125;</span><br><span class="line">                users_db.append(new_user)</span><br><span class="line">                imported_users.append(new_user)</span><br><span class="line">                next_id += <span class="number">1</span></span><br><span class="line">                </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                errors.append(<span class="string">f&quot;第<span class="subst">&#123;row_idx&#125;</span>行：处理失败 - <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 返回结果</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;code&quot;</span>: <span class="number">200</span>,</span><br><span class="line">            <span class="string">&quot;message&quot;</span>: <span class="string">f&quot;导入完成，成功<span class="subst">&#123;<span class="built_in">len</span>(imported_users)&#125;</span>条，失败<span class="subst">&#123;<span class="built_in">len</span>(errors)&#125;</span>条&quot;</span>,</span><br><span class="line">            <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;imported_count&quot;</span>: <span class="built_in">len</span>(imported_users),</span><br><span class="line">                <span class="string">&quot;error_count&quot;</span>: <span class="built_in">len</span>(errors),</span><br><span class="line">                <span class="string">&quot;errors&quot;</span>: errors[:<span class="number">10</span>]  <span class="comment"># 只返回前10个错误</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">500</span>, detail=<span class="string">f&quot;文件处理失败：<span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Excel导出接口</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/api/users/export&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">export_users</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    导出用户数据</span></span><br><span class="line"><span class="string">    从数据库查询数据，生成Excel文件</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 创建工作簿</span></span><br><span class="line">        workbook = Workbook()</span><br><span class="line">        sheet = workbook.active</span><br><span class="line">        sheet.title = <span class="string">&quot;用户数据&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 设置表头</span></span><br><span class="line">        headers = [<span class="string">&#x27;ID&#x27;</span>, <span class="string">&#x27;姓名&#x27;</span>, <span class="string">&#x27;邮箱&#x27;</span>, <span class="string">&#x27;年龄&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> col_idx, header <span class="keyword">in</span> <span class="built_in">enumerate</span>(headers, start=<span class="number">1</span>):</span><br><span class="line">            cell = sheet.cell(row=<span class="number">1</span>, column=col_idx)</span><br><span class="line">            cell.value = header</span><br><span class="line">            cell.font = Font(bold=<span class="literal">True</span>)</span><br><span class="line">            cell.alignment = Alignment(horizontal=<span class="string">&#x27;center&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 填充数据</span></span><br><span class="line">        <span class="keyword">for</span> row_idx, user <span class="keyword">in</span> <span class="built_in">enumerate</span>(users_db, start=<span class="number">2</span>):</span><br><span class="line">            sheet.cell(row=row_idx, column=<span class="number">1</span>, value=user[<span class="string">&quot;id&quot;</span>])</span><br><span class="line">            sheet.cell(row=row_idx, column=<span class="number">2</span>, value=user[<span class="string">&quot;name&quot;</span>])</span><br><span class="line">            sheet.cell(row=row_idx, column=<span class="number">3</span>, value=user[<span class="string">&quot;email&quot;</span>])</span><br><span class="line">            sheet.cell(row=row_idx, column=<span class="number">4</span>, value=user[<span class="string">&quot;age&quot;</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 调整列宽</span></span><br><span class="line">        sheet.column_dimensions[<span class="string">&#x27;A&#x27;</span>].width = <span class="number">10</span></span><br><span class="line">        sheet.column_dimensions[<span class="string">&#x27;B&#x27;</span>].width = <span class="number">20</span></span><br><span class="line">        sheet.column_dimensions[<span class="string">&#x27;C&#x27;</span>].width = <span class="number">30</span></span><br><span class="line">        sheet.column_dimensions[<span class="string">&#x27;D&#x27;</span>].width = <span class="number">10</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 保存到内存</span></span><br><span class="line">        output = io.BytesIO()</span><br><span class="line">        workbook.save(output)</span><br><span class="line">        output.seek(<span class="number">0</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 返回文件</span></span><br><span class="line">        <span class="keyword">return</span> FileResponse(</span><br><span class="line">            path=<span class="literal">None</span>,</span><br><span class="line">            filename=<span class="string">&quot;用户数据.xlsx&quot;</span>,</span><br><span class="line">            media_type=<span class="string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">500</span>, detail=<span class="string">f&quot;导出失败：<span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取用户列表（用于测试）</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/api/users&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_users</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;code&quot;</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">&quot;data&quot;</span>: users_db</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="代码解析">4.3.3 代码解析</h3>
<p><strong>核心功能</strong>：</p>
<ol type="1">
<li><strong>导入功能</strong>：
<ul>
<li>接收Excel文件上传</li>
<li>使用<code>openpyxl</code>读取Excel</li>
<li>验证表头格式</li>
<li>逐行解析数据并验证</li>
<li>保存到数据库</li>
</ul></li>
<li><strong>导出功能</strong>：
<ul>
<li>从数据库查询数据</li>
<li>使用<code>openpyxl</code>创建Excel</li>
<li>设置表头和样式</li>
<li>填充数据</li>
<li>返回文件下载</li>
</ul></li>
<li><strong>数据验证</strong>：
<ul>
<li>验证文件类型</li>
<li>验证表头格式</li>
<li>验证每行数据（姓名、邮箱、年龄）</li>
<li>检查重复数据</li>
</ul></li>
</ol>
<hr />
<h2 id="测试接口">4.4 测试接口</h2>
<h3 id="测试导入功能">4.4.1 测试导入功能</h3>
<p><strong>使用APIFox测试</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">方法：POST</span><br><span class="line">URL：http://localhost:8000/api/users/import</span><br><span class="line">请求体：form-data</span><br><span class="line">  - file: [选择Excel文件]</span><br></pre></td></tr></table></figure>
<p><strong>Excel文件格式</strong>：</p>
<table>
<thead>
<tr class="header">
<th>姓名</th>
<th>邮箱</th>
<th>年龄</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>张三</td>
<td>zhangsan@example.com</td>
<td>20</td>
</tr>
<tr class="even">
<td>李四</td>
<td>lisi@example.com</td>
<td>25</td>
</tr>
<tr class="odd">
<td>王五</td>
<td>wangwu@example.com</td>
<td>30</td>
</tr>
</tbody>
</table>
<h3 id="测试导出功能">4.4.2 测试导出功能</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">方法：GET</span><br><span class="line">URL：http://localhost:8000/api/users/export</span><br></pre></td></tr></table></figure>
<p><strong>响应</strong>：自动下载Excel文件</p>
<hr />
<h2 id="优化建议">4.5 优化建议</h2>
<h3 id="处理大文件">4.5.1 处理大文件</h3>
<p><strong>问题</strong>：如果Excel文件很大（几万行），一次性加载到内存会占用很多内存</p>
<p><strong>解决方案</strong>：分批处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分批处理，每次处理1000行</span></span><br><span class="line">BATCH_SIZE = <span class="number">1000</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(rows), BATCH_SIZE):</span><br><span class="line">    batch = rows[i:i+BATCH_SIZE]</span><br><span class="line">    process_batch(batch)</span><br></pre></td></tr></table></figure>
<h3 id="异步处理">4.5.2 异步处理</h3>
<p><strong>问题</strong>：导入大文件时，接口响应时间很长</p>
<p><strong>解决方案</strong>：使用后台任务</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> BackgroundTasks</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/api/users/import&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">import_users</span>(<span class="params"></span></span><br><span class="line"><span class="params">    file: UploadFile = File(<span class="params">...</span>),</span></span><br><span class="line"><span class="params">    background_tasks: BackgroundTasks = <span class="literal">None</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="comment"># 异步处理</span></span><br><span class="line">    background_tasks.add_task(process_import, file)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;导入任务已提交，正在处理中&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="错误处理优化">4.5.3 错误处理优化</h3>
<p><strong>返回详细的错误信息</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回每行的错误详情</span></span><br><span class="line">errors = [</span><br><span class="line">    &#123;<span class="string">&quot;row&quot;</span>: <span class="number">2</span>, <span class="string">&quot;field&quot;</span>: <span class="string">&quot;邮箱&quot;</span>, <span class="string">&quot;error&quot;</span>: <span class="string">&quot;邮箱格式不正确&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;row&quot;</span>: <span class="number">3</span>, <span class="string">&quot;field&quot;</span>: <span class="string">&quot;年龄&quot;</span>, <span class="string">&quot;error&quot;</span>: <span class="string">&quot;年龄必须在0-150之间&quot;</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<hr />
<blockquote>
<p>💡 <strong>关键理解</strong>：<br />
Excel导入导出是常见的业务需求。<br />
使用AI可以快速生成代码，但需要理解代码逻辑，并根据实际需求进行优化。</p>
</blockquote>
<hr />
<h1 id="选讲数据库索引优化">5. 选讲：数据库索引优化</h1>
<h2 id="为什么需要索引">5.1 为什么需要索引？</h2>
<p><strong>问题</strong>：数据库中有100万条用户数据，如何快速找到某个用户？</p>
<p><strong>没有索引的情况</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查找邮箱为 &quot;zhangsan@example.com&quot; 的用户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> email <span class="operator">=</span> <span class="string">&#x27;zhangsan@example.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 数据库需要逐行扫描，检查每一行的email字段</span></span><br><span class="line"><span class="comment">-- 最坏情况：需要扫描100万行</span></span><br><span class="line"><span class="comment">-- 时间：可能几秒钟</span></span><br></pre></td></tr></table></figure>
<p><strong>有索引的情况</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建索引后</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_email <span class="keyword">ON</span> users(email);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查找邮箱为 &quot;zhangsan@example.com&quot; 的用户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> email <span class="operator">=</span> <span class="string">&#x27;zhangsan@example.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 数据库使用索引，直接定位到目标行</span></span><br><span class="line"><span class="comment">-- 时间：几毫秒</span></span><br></pre></td></tr></table></figure>
<p><strong>生活类比</strong>：</p>
<ul>
<li><strong>没有索引</strong>：在一本没有目录的书中找内容，需要逐页翻找</li>
<li><strong>有索引</strong>：使用目录，直接翻到对应页码</li>
</ul>
<hr />
<h2 id="什么是索引">5.2 什么是索引？</h2>
<p><strong>索引</strong> = 数据库的"目录"，帮助快速定位数据</p>
<p><strong>工作原理</strong>：</p>
<ol type="1">
<li>数据库为索引字段创建额外的数据结构（如B+树）</li>
<li>查询时，先查索引，找到数据位置</li>
<li>根据位置，直接读取数据</li>
</ol>
<p><strong>实际例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">用户表（users）：</span><br><span class="line">┌────┬──────────┬──────────────┐</span><br><span class="line">│ id │ name     │ email        │</span><br><span class="line">├────┼──────────┼──────────────┤</span><br><span class="line">│ 1  │ 张三     │ zs@qq.com    │</span><br><span class="line">│ 2  │ 李四     │ ls@qq.com    │</span><br><span class="line">│ 3  │ 王五     │ ww@qq.com    │</span><br><span class="line">└────┴──────────┴──────────────┘</span><br><span class="line"></span><br><span class="line">索引（idx_email）：</span><br><span class="line">┌──────────────┬──────┐</span><br><span class="line">│ email        │ id   │</span><br><span class="line">├──────────────┼──────┤</span><br><span class="line">│ ls@qq.com    │ 2    │</span><br><span class="line">│ ww@qq.com    │ 3    │</span><br><span class="line">│ zs@qq.com    │ 1    │</span><br><span class="line">└──────────────┴──────┘</span><br><span class="line"></span><br><span class="line">查询 &quot;zs@qq.com&quot;：</span><br><span class="line">1. 在索引中查找 &quot;zs@qq.com&quot; → 找到 id=1</span><br><span class="line">2. 根据 id=1，直接读取 users 表的第1行</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="索引的类型">5.3 索引的类型</h2>
<h3 id="主键索引primary-key">5.3.1 主键索引（PRIMARY KEY）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>✅ 自动创建（定义主键时自动创建）</li>
<li>✅ 唯一性（不能有重复值）</li>
<li>✅ 非空（不能为NULL）</li>
</ul>
<p><strong>实际例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,  <span class="comment">-- 自动创建主键索引</span></span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="唯一索引unique">5.3.2 唯一索引（UNIQUE）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>✅ 唯一性（不能有重复值）</li>
<li>✅ 可以为NULL（但NULL值只能有一个）</li>
</ul>
<p><strong>实际例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span>,  <span class="comment">-- 创建唯一索引</span></span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span>  <span class="comment">-- 创建唯一索引</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="普通索引index">5.3.3 普通索引（INDEX）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>✅ 允许重复值</li>
<li>✅ 提高查询速度</li>
</ul>
<p><strong>实际例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建普通索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_name <span class="keyword">ON</span> users(name);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或者创建表时定义</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    INDEX idx_name(name)  <span class="comment">-- 创建普通索引</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="组合索引复合索引">5.3.4 组合索引（复合索引）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>✅ 多个字段组合成一个索引</li>
<li>✅ 适合多字段查询</li>
</ul>
<p><strong>实际例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建组合索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_name_age <span class="keyword">ON</span> users(name, age);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 适合的查询：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;张三&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">20</span>;  <span class="comment">-- ✅ 使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;张三&#x27;</span>;  <span class="comment">-- ✅ 使用索引（最左前缀）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">20</span>;  <span class="comment">-- ❌ 不使用索引（没有最左字段）</span></span><br></pre></td></tr></table></figure>
<hr />
<h2 id="什么时候需要创建索引">5.4 什么时候需要创建索引？</h2>
<h3 id="需要创建索引的场景">5.4.1 需要创建索引的场景</h3>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>场景</th>
<th>说明</th>
<th>例子</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>主键字段</strong></td>
<td>自动创建，无需手动创建</td>
<td><code>id INT PRIMARY KEY</code></td>
</tr>
<tr class="even">
<td><strong>唯一字段</strong></td>
<td>经常用于查询和关联</td>
<td><code>email VARCHAR(100) UNIQUE</code></td>
</tr>
<tr class="odd">
<td><strong>外键字段</strong></td>
<td>经常用于关联查询</td>
<td><code>user_id INT, FOREIGN KEY (user_id) REFERENCES users(id)</code></td>
</tr>
<tr class="even">
<td><strong>经常查询的字段</strong></td>
<td>WHERE条件中经常使用的字段</td>
<td><code>status TINYINT, INDEX idx_status(status)</code></td>
</tr>
<tr class="odd">
<td><strong>经常排序的字段</strong></td>
<td>ORDER BY中经常使用的字段</td>
<td><code>created_at DATETIME, INDEX idx_created_at(created_at)</code></td>
</tr>
<tr class="even">
<td><strong>经常分组的字段</strong></td>
<td>GROUP BY中经常使用的字段</td>
<td><code>category VARCHAR(50), INDEX idx_category(category)</code></td>
</tr>
</tbody>
</table>
<h3 id="不需要创建索引的场景">5.4.2 不需要创建索引的场景</h3>
<table>
<thead>
<tr class="header">
<th>场景</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>数据量小的表</strong></td>
<td>少于1000行的表，索引效果不明显</td>
</tr>
<tr class="even">
<td><strong>很少查询的字段</strong></td>
<td>几乎不用于查询条件的字段</td>
</tr>
<tr class="odd">
<td><strong>经常更新的字段</strong></td>
<td>索引需要维护，更新频繁会影响性能</td>
</tr>
<tr class="even">
<td><strong>文本字段（过长）</strong></td>
<td>TEXT、LONGTEXT等，索引效果差</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="索引的优缺点">5.5 索引的优缺点</h2>
<h3 id="优点">5.5.1 优点</h3>
<table>
<thead>
<tr class="header">
<th>优点</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>提高查询速度</strong></td>
<td>查询速度提升几十倍甚至上百倍</td>
</tr>
<tr class="even">
<td><strong>加速排序</strong></td>
<td>ORDER BY操作更快</td>
</tr>
<tr class="odd">
<td><strong>加速关联</strong></td>
<td>JOIN操作更快</td>
</tr>
<tr class="even">
<td><strong>保证唯一性</strong></td>
<td>唯一索引保证数据唯一</td>
</tr>
</tbody>
</table>
<h3 id="缺点">5.5.2 缺点</h3>
<table>
<thead>
<tr class="header">
<th>缺点</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>占用存储空间</strong></td>
<td>索引需要额外的存储空间</td>
</tr>
<tr class="even">
<td><strong>降低写入速度</strong></td>
<td>INSERT、UPDATE、DELETE时需要更新索引</td>
</tr>
<tr class="odd">
<td><strong>维护成本</strong></td>
<td>索引需要定期维护</td>
</tr>
</tbody>
</table>
<p><strong>实际例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 没有索引：插入快，查询慢</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (name, email) <span class="keyword">VALUES</span> (<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;zs@qq.com&#x27;</span>);  <span class="comment">-- 快</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> email <span class="operator">=</span> <span class="string">&#x27;zs@qq.com&#x27;</span>;  <span class="comment">-- 慢（扫描全表）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 有索引：插入稍慢，查询快</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_email <span class="keyword">ON</span> users(email);</span><br><span class="line"><span class="keyword">INSERT INTO</span> users (name, email) <span class="keyword">VALUES</span> (<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;zs@qq.com&#x27;</span>);  <span class="comment">-- 稍慢（需要更新索引）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> email <span class="operator">=</span> <span class="string">&#x27;zs@qq.com&#x27;</span>;  <span class="comment">-- 快（使用索引）</span></span><br></pre></td></tr></table></figure>
<hr />
<h2 id="实际例子博客系统索引设计">5.6 实际例子：博客系统索引设计</h2>
<p><strong>用户表（users）</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,  <span class="comment">-- 主键索引（自动）</span></span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,       <span class="comment">-- 唯一索引（自动）</span></span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,         <span class="comment">-- 唯一索引（自动）</span></span><br><span class="line">    password <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    created_at DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    INDEX idx_status(status),                    <span class="comment">-- 普通索引：经常按状态查询</span></span><br><span class="line">    INDEX idx_created_at(created_at)              <span class="comment">-- 普通索引：经常按时间排序</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>文章表（articles）</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> articles (</span><br><span class="line">    id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,  <span class="comment">-- 主键索引（自动）</span></span><br><span class="line">    title <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    content TEXT <span class="keyword">NOT NULL</span>,</span><br><span class="line">    author_id <span class="type">INT</span> UNSIGNED <span class="keyword">NOT NULL</span>,             <span class="comment">-- 外键，需要索引</span></span><br><span class="line">    category <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    status TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    view_count <span class="type">INT</span> UNSIGNED <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    created_at DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    INDEX idx_author_id(author_id),               <span class="comment">-- 普通索引：经常按作者查询</span></span><br><span class="line">    INDEX idx_category(category),                 <span class="comment">-- 普通索引：经常按分类查询</span></span><br><span class="line">    INDEX idx_status(status),                     <span class="comment">-- 普通索引：经常按状态查询</span></span><br><span class="line">    INDEX idx_created_at(created_at),            <span class="comment">-- 普通索引：经常按时间排序</span></span><br><span class="line">    INDEX idx_category_status(category, status),  <span class="comment">-- 组合索引：经常同时按分类和状态查询</span></span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (author_id) <span class="keyword">REFERENCES</span> users(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>评论表（comments）</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> comments (</span><br><span class="line">    id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,  <span class="comment">-- 主键索引（自动）</span></span><br><span class="line">    article_id <span class="type">INT</span> UNSIGNED <span class="keyword">NOT NULL</span>,            <span class="comment">-- 外键，需要索引</span></span><br><span class="line">    user_id <span class="type">INT</span> UNSIGNED <span class="keyword">NOT NULL</span>,               <span class="comment">-- 外键，需要索引</span></span><br><span class="line">    content TEXT <span class="keyword">NOT NULL</span>,</span><br><span class="line">    created_at DATETIME <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    INDEX idx_article_id(article_id),            <span class="comment">-- 普通索引：经常按文章查询</span></span><br><span class="line">    INDEX idx_user_id(user_id),                  <span class="comment">-- 普通索引：经常按用户查询</span></span><br><span class="line">    INDEX idx_article_created(article_id, created_at),  <span class="comment">-- 组合索引：按文章和时间排序</span></span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (article_id) <span class="keyword">REFERENCES</span> articles(id),</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>索引使用场景</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ✅ 使用索引的查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles <span class="keyword">WHERE</span> author_id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 使用 idx_author_id</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles <span class="keyword">WHERE</span> category <span class="operator">=</span> <span class="string">&#x27;技术&#x27;</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 使用 idx_category_status</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> comments <span class="keyword">WHERE</span> article_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> created_at;  <span class="comment">-- 使用 idx_article_created</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 不使用索引的查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles <span class="keyword">WHERE</span> content <span class="keyword">LIKE</span> <span class="string">&#x27;%关键词%&#x27;</span>;  <span class="comment">-- TEXT字段，无法使用索引</span></span><br></pre></td></tr></table></figure>
<hr />
<h2 id="索引优化技巧">5.7 索引优化技巧</h2>
<h3 id="最左前缀原则">5.7.1 最左前缀原则</h3>
<p><strong>组合索引遵循最左前缀原则</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建组合索引</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_name_age_city <span class="keyword">ON</span> users(name, age, city);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ✅ 可以使用索引的查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;张三&#x27;</span>;  <span class="comment">-- 使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;张三&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">20</span>;  <span class="comment">-- 使用索引</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;张三&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">20</span> <span class="keyword">AND</span> city <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span>;  <span class="comment">-- 使用索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ❌ 不能使用索引的查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">20</span>;  <span class="comment">-- 没有最左字段name</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> city <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span>;  <span class="comment">-- 没有最左字段name</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">20</span> <span class="keyword">AND</span> city <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span>;  <span class="comment">-- 没有最左字段name</span></span><br></pre></td></tr></table></figure>
<h3 id="避免过多索引">5.7.2 避免过多索引</h3>
<p><strong>问题</strong>：索引不是越多越好</p>
<p><strong>原因</strong>：</p>
<ul>
<li>❌ 每个索引都需要存储空间</li>
<li>❌ 每次INSERT/UPDATE/DELETE都需要更新所有相关索引</li>
<li>❌ 索引过多会影响写入性能</li>
</ul>
<p><strong>建议</strong>：</p>
<ul>
<li>✅ 只为经常查询的字段创建索引</li>
<li>✅ 定期检查未使用的索引并删除</li>
</ul>
<h3 id="索引字段选择">5.7.3 索引字段选择</h3>
<p><strong>选择原则</strong>：</p>
<table>
<thead>
<tr class="header">
<th>字段类型</th>
<th>是否适合索引</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>整数类型</strong></td>
<td>✅ 非常适合</td>
<td>INT、TINYINT等，查询效率高</td>
</tr>
<tr class="even">
<td><strong>短字符串</strong></td>
<td>✅ 适合</td>
<td>VARCHAR(50)以内，可以创建索引</td>
</tr>
<tr class="odd">
<td><strong>长字符串</strong></td>
<td>⚠️ 谨慎使用</td>
<td>VARCHAR(255)以上，索引效果差</td>
</tr>
<tr class="even">
<td><strong>文本类型</strong></td>
<td>❌ 不适合</td>
<td>TEXT、LONGTEXT，无法创建普通索引</td>
</tr>
<tr class="odd">
<td><strong>日期时间</strong></td>
<td>✅ 适合</td>
<td>DATETIME、TIMESTAMP，经常用于排序</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="查看索引使用情况">5.8 查看索引使用情况</h2>
<h3 id="查看表的索引">5.8.1 查看表的索引</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看表的所有索引</span></span><br><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果示例：</span></span><br><span class="line"><span class="comment">-- Key_name: PRIMARY, Column_name: id</span></span><br><span class="line"><span class="comment">-- Key_name: idx_email, Column_name: email</span></span><br><span class="line"><span class="comment">-- Key_name: idx_status, Column_name: status</span></span><br></pre></td></tr></table></figure>
<h3 id="分析查询是否使用索引">5.8.2 分析查询是否使用索引</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用EXPLAIN分析查询</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> email <span class="operator">=</span> <span class="string">&#x27;zhangsan@example.com&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 结果中的key字段显示使用的索引</span></span><br><span class="line"><span class="comment">-- key: idx_email 表示使用了idx_email索引</span></span><br><span class="line"><span class="comment">-- key: NULL 表示没有使用索引</span></span><br></pre></td></tr></table></figure>
<hr />
<h2 id="索引优化总结">5.9 索引优化总结</h2>
<p><strong>创建索引的原则</strong>：</p>
<ol type="1">
<li><strong>主键和外键</strong>：必须创建索引</li>
<li><strong>经常查询的字段</strong>：创建索引</li>
<li><strong>经常排序的字段</strong>：创建索引</li>
<li><strong>组合查询</strong>：创建组合索引</li>
<li><strong>不要过度索引</strong>：只为必要的字段创建索引</li>
</ol>
<p><strong>索引优化检查清单</strong>：</p>
<ul>
<li>✅ 主键字段有索引</li>
<li>✅ 外键字段有索引</li>
<li>✅ 唯一字段有索引</li>
<li>✅ 经常WHERE的字段有索引</li>
<li>✅ 经常ORDER BY的字段有索引</li>
<li>✅ 组合查询有组合索引</li>
<li>❌ 没有为很少查询的字段创建索引</li>
<li>❌ 没有为TEXT字段创建普通索引</li>
</ul>
<hr />
<blockquote>
<p>💡 <strong>关键理解</strong>：<br />
索引是数据库性能优化的关键。<br />
合理使用索引可以大幅提升查询速度，但也要注意不要过度索引。<br />
对于初学者，先为主键、外键、唯一字段创建索引，再根据实际查询需求添加其他索引。</p>
</blockquote>
<hr />
<h2 id="本章总结">本章总结</h2>
<p>通过本章的学习，你已经掌握了：</p>
<p>✅ <strong>数据库设计</strong>：</p>
<ul>
<li>MySQL数据类型的选择（TINYINT、VARCHAR、TEXT等）</li>
<li>根据实际需求选择合适的数据类型</li>
<li>节省存储空间，提高查询性能</li>
</ul>
<p>✅ <strong>API实现</strong>：</p>
<ul>
<li>使用FastAPI实现CRUD接口</li>
<li>连接数据库进行数据操作</li>
<li>统一响应格式和错误处理</li>
</ul>
<p>✅ <strong>数据验证</strong>：</p>
<ul>
<li>使用Pydantic进行数据验证</li>
<li>常用验证规则（字符串、数字、邮箱等）</li>
<li>验证错误处理</li>
</ul>
<p>✅ <strong>实战技能</strong>：</p>
<ul>
<li>使用AI实现Excel导入导出功能</li>
<li>处理文件上传和下载</li>
<li>数据验证和错误处理</li>
</ul>
<p>✅ <strong>进阶知识</strong>（选讲）：</p>
<ul>
<li>数据库索引的作用和类型</li>
<li>索引的创建和使用</li>
<li>索引优化技巧</li>
</ul>
<blockquote>
<p>🌟 <strong>恭喜你！</strong><br />
你已经掌握了后端开发的基础技能！<br />
这些知识将帮助你：</p>
<ul>
<li><p>设计合理的数据库结构</p></li>
<li><p>实现规范的API接口</p></li>
<li><p>处理数据验证和错误</p></li>
<li><p>优化数据库查询性能</p></li>
</ul>
<p><strong>记住</strong>：后端开发的核心是数据处理和业务逻辑！<br />
<strong>继续练习，继续探索，后端开发的世界等着你！</strong> 🚀</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.csgrandeur.cn/2025-12-23-12-RESTful-API%E8%AE%BE%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CSGrandeur">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025-12-23-12-RESTful-API%E8%AE%BE%E8%AE%A1/" class="post-title-link" itemprop="url">12.RESTful API设计</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-12-23 13:32:23 / 修改时间：17:02:38" itemprop="dateCreated datePublished" datetime="2025-12-23T13:32:23+08:00">2025-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="为什么需要restful-api">1. 为什么需要RESTful API？</h1>
<h2 id="开发无非增删查改crud的智慧">1.1
开发无非增删查改：CRUD的智慧</h2>
<p><strong>CRUD</strong> =
Create（创建）、Read（读取）、Update（更新）、Delete（删除）</p>
<p><strong>生活类比</strong>：</p>
<p>想象你在管理一个<strong>图书馆</strong>：</p>
<ul>
<li><strong>Create（创建）</strong>：新书到了，登记入库</li>
<li><strong>Read（读取）</strong>：读者想找书，你去查找</li>
<li><strong>Update（更新）</strong>：书的信息有变化，更新记录</li>
<li><strong>Delete（删除）</strong>：旧书淘汰了，删除记录</li>
</ul>
<p><strong>实际例子</strong>：</p>
<p>无论是博客系统、电商网站，还是待办事项应用，核心功能都是这4个操作：</p>
<p>博客系统：</p>
<ul>
<li>Create：发布新文章</li>
<li>Read：查看文章列表、查看文章详情</li>
<li>Update：编辑文章</li>
<li>Delete：删除文章</li>
</ul>
<p>用户管理：</p>
<ul>
<li>Create：注册新用户</li>
<li>Read：查看用户信息</li>
<li>Update：修改用户信息</li>
<li>Delete：删除用户</li>
</ul>
<blockquote>
<p>💡 <strong>关键理解</strong>：<br />
99%的Web应用，核心功能就是CRUD！<br />
学会了CRUD，你就掌握了Web开发的核心！</p>
</blockquote>
<hr />
<h2 id="restful-apicrud的标准表达">1.2 RESTful API：CRUD的标准表达</h2>
<p>既然开发的核心是CRUD，那如何用API来表达这4个操作呢？</p>
<p><strong>传统方式</strong>（不统一）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Create：/createUser</span><br><span class="line">Read：  /getUser?id=1</span><br><span class="line">Update：/updateUser?id=1</span><br><span class="line">Delete：/deleteUser?id=1</span><br></pre></td></tr></table></figure>
<p><strong>问题</strong>：每个接口命名都不一样，没有规律，难以记忆</p>
<p><strong>RESTful方式</strong>（统一规范）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Create：POST   /users</span><br><span class="line">Read：  GET    /users/1</span><br><span class="line">Update：PUT    /users/1</span><br><span class="line">Delete：DELETE /users/1</span><br></pre></td></tr></table></figure>
<p><strong>优势</strong>：</p>
<ul>
<li>✅ 统一：都用同一个资源（<code>/users</code>）</li>
<li>✅ 清晰：HTTP方法直接表达操作类型</li>
<li>✅ 规范：所有接口都遵循相同模式</li>
</ul>
<hr />
<h2 id="restful-api的定义">1.3 RESTful API的定义</h2>
<p><strong>RESTful API</strong> = 遵循REST规范的API设计方式</p>
<p><strong>REST</strong> = Representational State
Transfer（表述性状态转移）</p>
<p><strong>核心思想</strong>：用<strong>资源</strong>和<strong>HTTP方法</strong>来设计API</p>
<p><strong>CRUD与HTTP方法的对应关系</strong>：</p>
<table>
<thead>
<tr class="header">
<th>CRUD操作</th>
<th>HTTP方法</th>
<th>RESTful API示例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Create（创建）</strong></td>
<td>POST</td>
<td><code>POST /users</code></td>
</tr>
<tr class="even">
<td><strong>Read（读取）</strong></td>
<td>GET</td>
<td><code>GET /users</code> 或 <code>GET /users/1</code></td>
</tr>
<tr class="odd">
<td><strong>Update（更新）</strong></td>
<td>PUT/PATCH</td>
<td><code>PUT /users/1</code></td>
</tr>
<tr class="even">
<td><strong>Delete（删除）</strong></td>
<td>DELETE</td>
<td><code>DELETE /users/1</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p>💡 <strong>记忆技巧</strong>：<br />
RESTful API = 用"资源"和"动作"来设计接口<br />
CRUD的4个操作，对应HTTP的4个方法，简单明了！</p>
</blockquote>
<hr />
<h1 id="restful规范">2. RESTful规范</h1>
<h2 id="资源resource">2.1 资源（Resource）</h2>
<p><strong>资源</strong> = API操作的对象（如用户、文章、订单）</p>
<p><strong>命名规范</strong>：</p>
<ul>
<li>✅ 使用<strong>名词</strong>（复数形式）</li>
<li>✅ 使用<strong>小写字母</strong></li>
<li>✅ 多个单词用<strong>连字符</strong>（<code>-</code>）连接</li>
</ul>
<p><strong>实际例子</strong>：</p>
<table>
<thead>
<tr class="header">
<th>✅ 正确</th>
<th>❌ 错误</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>/users</code></td>
<td><code>/getUsers</code>、<code>/user</code></td>
</tr>
<tr class="even">
<td><code>/articles</code></td>
<td><code>/articleList</code>、<code>/article</code></td>
</tr>
<tr class="odd">
<td><code>/todo-items</code></td>
<td><code>/todoItems</code>、<code>/todos</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="http方法">2.2 HTTP方法</h2>
<p><strong>HTTP方法</strong> = 对资源执行的操作</p>
<table style="width:100%;">
<colgroup>
<col style="width: 42%" />
<col style="width: 28%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="header">
<th>HTTP方法</th>
<th>作用</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>GET</strong></td>
<td>获取资源</td>
<td><code>GET /users</code> - 获取用户列表</td>
</tr>
<tr class="even">
<td><strong>POST</strong></td>
<td>创建资源</td>
<td><code>POST /users</code> - 创建新用户</td>
</tr>
<tr class="odd">
<td><strong>PUT</strong></td>
<td>更新资源（完整更新）</td>
<td><code>PUT /users/1</code> - 更新用户1的所有信息</td>
</tr>
<tr class="even">
<td><strong>PATCH</strong></td>
<td>更新资源（部分更新）</td>
<td><code>PATCH /users/1</code> - 只更新用户1的部分信息</td>
</tr>
<tr class="odd">
<td><strong>DELETE</strong></td>
<td>删除资源</td>
<td><code>DELETE /users/1</code> - 删除用户1</td>
</tr>
</tbody>
</table>
<p><strong>实际例子</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取用户列表</span></span><br><span class="line"><span class="variable constant_">GET</span> /users</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取单个用户</span></span><br><span class="line"><span class="variable constant_">GET</span> /users/<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建新用户</span></span><br><span class="line"><span class="variable constant_">POST</span> /users</span><br><span class="line"><span class="title class_">Body</span>: &#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>, <span class="string">&quot;email&quot;</span>: <span class="string">&quot;zhangsan@example.com&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新用户</span></span><br><span class="line"><span class="variable constant_">PUT</span> /users/<span class="number">1</span></span><br><span class="line"><span class="title class_">Body</span>: &#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;李四&quot;</span>, <span class="string">&quot;email&quot;</span>: <span class="string">&quot;lisi@example.com&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除用户</span></span><br><span class="line"><span class="variable constant_">DELETE</span> /users/<span class="number">1</span></span><br></pre></td></tr></table></figure>
<hr />
<h2 id="url设计规范">2.3 URL设计规范</h2>
<h3 id="资源层级">2.3.1 资源层级</h3>
<p><strong>原则</strong>：用URL路径表示资源的层级关系</p>
<p><strong>实际例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">✅ 正确：</span><br><span class="line">GET /users/1/articles        # 获取用户1的所有文章</span><br><span class="line">GET /users/1/articles/5      # 获取用户1的第5篇文章</span><br><span class="line">GET /articles/5/comments     # 获取文章5的所有评论</span><br><span class="line"></span><br><span class="line">❌ 错误：</span><br><span class="line">GET /getUserArticles?userId=1&amp;articleId=5  # 不符合RESTful规范</span><br></pre></td></tr></table></figure>
<hr />
<h3 id="查询参数">2.3.2 查询参数</h3>
<p><strong>作用</strong>：用于过滤、排序、分页等</p>
<p><strong>实际例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 过滤</span><br><span class="line">GET /users?status=active          # 获取状态为active的用户</span><br><span class="line"></span><br><span class="line"># 排序</span><br><span class="line">GET /articles?sort=createdAt&amp;order=desc  # 按创建时间倒序</span><br><span class="line"></span><br><span class="line"># 分页</span><br><span class="line">GET /articles?page=1&amp;limit=10     # 第1页，每页10条</span><br><span class="line"></span><br><span class="line"># 组合使用</span><br><span class="line">GET /articles?status=published&amp;page=1&amp;limit=10&amp;sort=createdAt</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="http状态码">2.4 HTTP状态码</h2>
<p><strong>状态码</strong> = 表示请求的结果</p>
<p><strong>常用状态码</strong>：</p>
<table>
<thead>
<tr class="header">
<th>状态码</th>
<th>含义</th>
<th>使用场景</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>200</strong></td>
<td>成功</td>
<td>请求成功</td>
</tr>
<tr class="even">
<td><strong>201</strong></td>
<td>已创建</td>
<td>创建资源成功</td>
</tr>
<tr class="odd">
<td><strong>400</strong></td>
<td>请求错误</td>
<td>参数错误、格式错误</td>
</tr>
<tr class="even">
<td><strong>401</strong></td>
<td>未授权</td>
<td>未登录或token过期</td>
</tr>
<tr class="odd">
<td><strong>403</strong></td>
<td>禁止访问</td>
<td>没有权限</td>
</tr>
<tr class="even">
<td><strong>404</strong></td>
<td>未找到</td>
<td>资源不存在</td>
</tr>
<tr class="odd">
<td><strong>500</strong></td>
<td>服务器错误</td>
<td>服务器内部错误</td>
</tr>
</tbody>
</table>
<p><strong>实际例子</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 成功</span></span><br><span class="line"><span class="variable constant_">GET</span> /users/<span class="number">1</span></span><br><span class="line"><span class="title class_">Response</span>: <span class="number">200</span> <span class="variable constant_">OK</span></span><br><span class="line"><span class="title class_">Body</span>: &#123; <span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 资源不存在</span></span><br><span class="line"><span class="variable constant_">GET</span> /users/<span class="number">999</span></span><br><span class="line"><span class="title class_">Response</span>: <span class="number">404</span> <span class="title class_">Not</span> <span class="title class_">Found</span></span><br><span class="line"><span class="title class_">Body</span>: &#123; <span class="string">&quot;error&quot;</span>: <span class="string">&quot;用户不存在&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数错误</span></span><br><span class="line"><span class="variable constant_">POST</span> /users</span><br><span class="line"><span class="title class_">Body</span>: &#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span> &#125;  <span class="comment">// 名字为空</span></span><br><span class="line"><span class="title class_">Response</span>: <span class="number">400</span> <span class="title class_">Bad</span> <span class="title class_">Request</span></span><br><span class="line"><span class="title class_">Body</span>: &#123; <span class="string">&quot;error&quot;</span>: <span class="string">&quot;用户名不能为空&quot;</span> &#125;</span><br></pre></td></tr></table></figure>
<hr />
<h1 id="api设计原则">3. API设计原则</h1>
<h2 id="统一性原则">3.1 统一性原则</h2>
<p><strong>原则</strong>：所有接口遵循相同的设计规范</p>
<p><strong>实际例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">✅ 统一的设计：</span><br><span class="line">GET    /users          # 获取用户列表</span><br><span class="line">GET    /users/:id      # 获取单个用户</span><br><span class="line">POST   /users          # 创建用户</span><br><span class="line">PUT    /users/:id      # 更新用户</span><br><span class="line">DELETE /users/:id      # 删除用户</span><br><span class="line"></span><br><span class="line">GET    /articles       # 获取文章列表</span><br><span class="line">GET    /articles/:id   # 获取单个文章</span><br><span class="line">POST   /articles       # 创建文章</span><br><span class="line">PUT    /articles/:id   # 更新文章</span><br><span class="line">DELETE /articles/:id   # 删除文章</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="简洁性原则">3.2 简洁性原则</h2>
<p><strong>原则</strong>：URL要简洁明了，避免过长</p>
<p><strong>实际例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">✅ 简洁：</span><br><span class="line">GET /users/1</span><br><span class="line"></span><br><span class="line">❌ 冗长：</span><br><span class="line">GET /api/v1/users/getUserById?id=1&amp;format=json</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="可扩展性原则">3.3 可扩展性原则</h2>
<p><strong>原则</strong>：设计时要考虑未来可能的功能扩展</p>
<p><strong>实际例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">✅ 可扩展：</span><br><span class="line">GET /users/:id/articles        # 可以扩展为获取用户的其他资源</span><br><span class="line">GET /users/:id/articles/:id   # 可以扩展为获取用户的具体文章</span><br><span class="line"></span><br><span class="line">❌ 不可扩展：</span><br><span class="line">GET /getUserArticles           # 难以扩展其他功能</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="安全性原则">3.4 安全性原则</h2>
<p><strong>原则</strong>：敏感操作需要认证和授权</p>
<h3 id="什么是认证和授权">3.4.1 什么是认证和授权？</h3>
<p><strong>认证（Authentication）</strong>：你是谁？——验证用户身份（登录）</p>
<p><strong>授权（Authorization）</strong>：你能做什么？——验证用户权限（是否有权限执行操作）</p>
<p><strong>生活类比</strong>：</p>
<ul>
<li><strong>认证</strong>：进学校要出示学生证（证明你是学生）</li>
<li><strong>授权</strong>：只有管理员才能进校长办公室（权限不同）</li>
</ul>
<h3 id="bearer-token身份凭证">3.4.2 Bearer Token：身份凭证</h3>
<p><strong>Bearer Token</strong> = 一种身份认证方式，就像"通行证"</p>
<p><strong>工作原理</strong>：</p>
<ol type="1">
<li><strong>登录获取Token</strong>：用户登录后，服务器返回一个Token</li>
<li><strong>携带Token请求</strong>：后续请求在Header中携带这个Token</li>
<li><strong>服务器验证</strong>：服务器验证Token，确认用户身份</li>
</ol>
<p><strong>实际例子</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一步：用户登录，获取Token</span></span><br><span class="line"><span class="variable constant_">POST</span> /api/login</span><br><span class="line"><span class="title class_">Body</span>: &#123; <span class="string">&quot;username&quot;</span>: <span class="string">&quot;zhangsan&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span> &#125;</span><br><span class="line"><span class="title class_">Response</span>: &#123;</span><br><span class="line">    <span class="string">&quot;code&quot;</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;token&quot;</span>: <span class="string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二步：使用Token访问需要认证的接口</span></span><br><span class="line"><span class="variable constant_">GET</span> /api/users/me</span><br><span class="line"><span class="title class_">Headers</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Authorization&quot;</span>: <span class="string">&quot;Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Response</span>: &#123;</span><br><span class="line">    <span class="string">&quot;code&quot;</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;zhangsan@example.com&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="bearer-token的使用方式">3.4.3 Bearer Token的使用方式</h3>
<p><strong>格式</strong>：<code>Authorization: Bearer &lt;token&gt;</code></p>
<p><strong>前端代码示例</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用axios发送请求</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录后保存Token</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">login</span> = <span class="keyword">async</span> (<span class="params">username, password</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/api/login&#x27;</span>, &#123;</span><br><span class="line">        username,</span><br><span class="line">        password</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 保存Token到本地存储</span></span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;token&#x27;</span>, response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">token</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Token访问需要认证的接口</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getUserInfo</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/api/users/me&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">data</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>后端验证示例</strong>（FastAPI）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Header, HTTPException</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟Token验证（实际应该用JWT库）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_token</span>(<span class="params">token: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="comment"># 实际项目中，这里应该验证JWT Token</span></span><br><span class="line">    <span class="keyword">return</span> token.startswith(<span class="string">&#x27;eyJ&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/api/users/me&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_current_user</span>(<span class="params"></span></span><br><span class="line"><span class="params">    authorization: <span class="type">Optional</span>[<span class="built_in">str</span>] = Header(<span class="params"><span class="literal">None</span></span>)</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> authorization:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">401</span>, detail=<span class="string">&quot;未登录&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 提取Token（去掉&quot;Bearer &quot;前缀）</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> authorization.startswith(<span class="string">&#x27;Bearer &#x27;</span>):</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">401</span>, detail=<span class="string">&quot;Token格式错误&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    token = authorization.replace(<span class="string">&#x27;Bearer &#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 验证Token</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> verify_token(token):</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">401</span>, detail=<span class="string">&quot;Token无效或已过期&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 返回用户信息</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;code&quot;</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">            <span class="string">&quot;email&quot;</span>: <span class="string">&quot;zhangsan@example.com&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="token的优势">3.4.4 Token的优势</h3>
<table>
<thead>
<tr class="header">
<th>优势</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>无状态</strong></td>
<td>服务器不需要存储Session，减轻服务器压力</td>
</tr>
<tr class="even">
<td><strong>跨域友好</strong></td>
<td>可以轻松实现跨域认证</td>
</tr>
<tr class="odd">
<td><strong>安全性高</strong></td>
<td>Token可以设置过期时间，防止长期有效</td>
</tr>
<tr class="even">
<td><strong>易于扩展</strong></td>
<td>可以在Token中携带用户信息（JWT）</td>
</tr>
</tbody>
</table>
<p><strong>实际例子</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要登录（认证）</span></span><br><span class="line"><span class="variable constant_">GET</span> /users/me          # 获取当前用户信息</span><br><span class="line"><span class="title class_">Headers</span>: &#123; <span class="string">&quot;Authorization&quot;</span>: <span class="string">&quot;Bearer token123&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要权限（授权）</span></span><br><span class="line"><span class="variable constant_">DELETE</span> /users/<span class="number">1</span>        # 删除用户（需要管理员权限）</span><br><span class="line"><span class="title class_">Headers</span>: &#123; <span class="string">&quot;Authorization&quot;</span>: <span class="string">&quot;Bearer admin_token&quot;</span> &#125;</span><br></pre></td></tr></table></figure>
<hr />
<h1 id="接口文档编写">4. 接口文档编写</h1>
<h2 id="为什么需要接口文档">4.1 为什么需要接口文档？</h2>
<p><strong>作用</strong>：</p>
<table>
<thead>
<tr class="header">
<th>作用</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>统一理解</strong></td>
<td>前后端对接口理解一致</td>
</tr>
<tr class="even">
<td><strong>提高效率</strong></td>
<td>前端不需要等后端，可以先看文档开发</td>
</tr>
<tr class="odd">
<td><strong>便于维护</strong></td>
<td>接口变更时，文档同步更新</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="接口文档的基本结构">4.2 接口文档的基本结构</h2>
<p><strong>包含内容</strong>：</p>
<ol type="1">
<li><strong>接口基本信息</strong>：URL、方法、描述</li>
<li><strong>请求参数</strong>：参数名、类型、是否必填、说明</li>
<li><strong>响应数据</strong>：响应格式、字段说明</li>
<li><strong>错误码</strong>：可能的错误情况</li>
</ol>
<p><strong>实际例子</strong>：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">## 获取用户列表</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**接口地址**</span>：<span class="code">`GET /api/users`</span></span><br><span class="line"></span><br><span class="line"><span class="strong">**接口描述**</span>：获取用户列表，支持分页和过滤</span><br><span class="line"></span><br><span class="line"><span class="strong">**请求参数**</span>：</span><br><span class="line"></span><br><span class="line">| 参数名 | 类型 | 必填 | 说明 |</span><br><span class="line">|--------|------|------|------|</span><br><span class="line">| page | number | 否 | 页码，默认1 |</span><br><span class="line">| limit | number | 否 | 每页数量，默认10 |</span><br><span class="line">| status | string | 否 | 用户状态（active/inactive） |</span><br><span class="line"></span><br><span class="line"><span class="strong">**请求示例**</span>：</span><br></pre></td></tr></table></figure>
<p>GET /api/users?page=1&amp;limit=10&amp;status=active
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**响应数据**：</span><br><span class="line">```json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 200,</span><br><span class="line">    &quot;message&quot;: &quot;成功&quot;,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;list&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;id&quot;: 1,</span><br><span class="line">                &quot;name&quot;: &quot;张三&quot;,</span><br><span class="line">                &quot;email&quot;: &quot;zhangsan@example.com&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;total&quot;: 100,</span><br><span class="line">        &quot;page&quot;: 1,</span><br><span class="line">        &quot;limit&quot;: 10</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>错误响应</strong>： <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">400</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;参数错误&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">## 4.3 使用工具编写接口文档</span><br><span class="line"></span><br><span class="line">### 4.3.1 Swagger/OpenAPI</span><br><span class="line"></span><br><span class="line">**Swagger** = 自动生成接口文档的工具</span><br><span class="line"></span><br><span class="line">**优势**：</span><br><span class="line"></span><br><span class="line">- ✅ 代码即文档（写代码时自动生成文档）</span><br><span class="line">- ✅ 可视化界面（可以直接测试接口）</span><br><span class="line">- ✅ 支持多种语言</span><br><span class="line"></span><br><span class="line">**实际例子**（FastAPI自动生成）：</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">from fastapi import FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">@app.get(&quot;/users/&#123;user_id&#125;&quot;)</span><br><span class="line">async def get_user(user_id: int):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    获取用户信息</span><br><span class="line">    </span><br><span class="line">    - **user_id**: 用户ID</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    return &#123;&quot;id&quot;: user_id, &quot;name&quot;: &quot;张三&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<p>访问 <code>http://localhost:8000/docs</code>
即可看到自动生成的文档。</p>
<hr />
<h3 id="markdown文档">4.3.2 Markdown文档</h3>
<p><strong>适用场景</strong>：简单项目、快速文档</p>
<p><strong>实际例子</strong>：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># API文档</span></span><br><span class="line"></span><br><span class="line"><span class="section">## 用户相关接口</span></span><br><span class="line"></span><br><span class="line"><span class="section">### 1. 获取用户列表</span></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**URL**</span>: <span class="code">`GET /api/users`</span></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**参数**</span>: <span class="code">`page`</span>, <span class="code">`limit`</span></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**响应**</span>: 用户列表</span><br><span class="line"></span><br><span class="line"><span class="section">### 2. 获取用户详情</span></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**URL**</span>: <span class="code">`GET /api/users/:id`</span></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**参数**</span>: <span class="code">`id`</span> (路径参数)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**响应**</span>: 用户信息</span><br></pre></td></tr></table></figure>
<hr />
<h1 id="ai实战使用ai设计文件上传api">5.
AI实战：使用AI设计文件上传API</h1>
<h2 id="任务描述">5.1 任务描述</h2>
<p><strong>目标</strong>：使用AI工具设计一个文件上传的RESTful API</p>
<p><strong>功能要求</strong>：</p>
<ul>
<li>支持上传图片文件</li>
<li>支持文件大小限制（最大5MB）</li>
<li>支持文件类型限制（只允许jpg、png、gif）</li>
<li>返回文件URL</li>
<li>遵循RESTful规范</li>
</ul>
<hr />
<h2 id="第一步设计prompt">5.2 第一步：设计Prompt</h2>
<p><strong>Prompt示例</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">设计一个文件上传的RESTful API，要求：</span><br><span class="line">1. 遵循RESTful规范</span><br><span class="line">2. 使用POST方法</span><br><span class="line">3. 支持图片上传（jpg、png、gif）</span><br><span class="line">4. 文件大小限制5MB</span><br><span class="line">5. 返回上传后的文件URL</span><br><span class="line">6. 包含完整的接口文档：</span><br><span class="line">   - 接口地址、方法、描述</span><br><span class="line">   - 请求参数说明</span><br><span class="line">   - 响应数据格式</span><br><span class="line">   - 错误处理</span><br><span class="line">7. 使用FastAPI实现（可选）</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="ai生成的api设计示例">5.3 AI生成的API设计（示例）</h2>
<h3 id="接口设计">5.3.1 接口设计</h3>
<p><strong>接口信息</strong>：</p>
<ul>
<li><strong>URL</strong>：<code>POST /api/files/upload</code></li>
<li><strong>方法</strong>：POST</li>
<li><strong>描述</strong>：上传文件</li>
</ul>
<p><strong>请求参数</strong>：</p>
<table>
<thead>
<tr class="header">
<th>参数名</th>
<th>类型</th>
<th>位置</th>
<th>必填</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>file</td>
<td>File</td>
<td>Body</td>
<td>是</td>
<td>要上传的文件</td>
</tr>
<tr class="even">
<td>type</td>
<td>string</td>
<td>Query</td>
<td>否</td>
<td>文件类型（image/document）</td>
</tr>
</tbody>
</table>
<p><strong>请求示例</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用FormData上传</span></span><br><span class="line"><span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, fileInput.<span class="property">files</span>[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;/api/files/upload&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="attr">body</span>: formData</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data));</span><br></pre></td></tr></table></figure>
<p><strong>成功响应</strong>（200）：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;上传成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;fileId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fileName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fileUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://example.com/uploads/image.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fileSize&quot;</span><span class="punctuation">:</span> <span class="number">102400</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;uploadedAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2024-01-15T10:30:00Z&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>错误响应</strong>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件太大（413）</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">413</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;文件大小超过限制（最大5MB）&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件类型不支持（400）</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">400</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;不支持的文件类型，仅支持jpg、png、gif&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<hr />
<h3 id="fastapi实现示例">5.3.2 FastAPI实现示例</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, UploadFile, File, HTTPException</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> JSONResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/api/files/upload&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">upload_file</span>(<span class="params"></span></span><br><span class="line"><span class="params">    file: UploadFile = File(<span class="params">...</span>),</span></span><br><span class="line"><span class="params">    <span class="built_in">type</span>: <span class="built_in">str</span> = <span class="string">&quot;image&quot;</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    上传文件</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    - **file**: 要上传的文件</span></span><br><span class="line"><span class="string">    - **type**: 文件类型（image/document）</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 检查文件大小（5MB限制）</span></span><br><span class="line">    contents = <span class="keyword">await</span> file.read()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(contents) &gt; <span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">413</span>, detail=<span class="string">&quot;文件大小超过限制（最大5MB）&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查文件类型</span></span><br><span class="line">    allowed_types = [<span class="string">&#x27;image/jpeg&#x27;</span>, <span class="string">&#x27;image/png&#x27;</span>, <span class="string">&#x27;image/gif&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> file.content_type <span class="keyword">not</span> <span class="keyword">in</span> allowed_types:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(</span><br><span class="line">            status_code=<span class="number">400</span>, </span><br><span class="line">            detail=<span class="string">&quot;不支持的文件类型，仅支持jpg、png、gif&quot;</span></span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存文件（这里简化处理）</span></span><br><span class="line">    file_url = <span class="string">f&quot;https://example.com/uploads/<span class="subst">&#123;file.filename&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;code&quot;</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;上传成功&quot;</span>,</span><br><span class="line">        <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;fileId&quot;</span>: <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">            <span class="string">&quot;fileName&quot;</span>: file.filename,</span><br><span class="line">            <span class="string">&quot;fileUrl&quot;</span>: file_url,</span><br><span class="line">            <span class="string">&quot;fileSize&quot;</span>: <span class="built_in">len</span>(contents),</span><br><span class="line">            <span class="string">&quot;uploadedAt&quot;</span>: <span class="string">&quot;2024-01-15T10:30:00Z&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="代码解析">5.4 代码解析</h2>
<p><strong>核心思路</strong>：</p>
<ol type="1">
<li><strong>使用POST方法</strong>：上传文件属于创建操作</li>
<li><strong>使用FormData</strong>：文件上传的标准格式</li>
<li><strong>参数验证</strong>：检查文件大小和类型</li>
<li><strong>统一响应格式</strong>：成功和错误都返回统一格式</li>
</ol>
<p><strong>关键点</strong>：</p>
<ul>
<li>遵循RESTful规范（POST方法、资源路径）</li>
<li>完整的错误处理</li>
<li>清晰的接口文档</li>
</ul>
<hr />
<h2 id="api调试软件">5.5 API调试软件</h2>
<h3 id="为什么需要api调试工具">5.5.1 为什么需要API调试工具？</h3>
<p><strong>问题</strong>：写好了API，如何测试？</p>
<p><strong>传统方式</strong>（不方便）：</p>
<ul>
<li>写前端代码调用API（太麻烦）</li>
<li>用浏览器只能测试GET请求（功能有限）</li>
<li>用命令行curl（不够直观）</li>
</ul>
<p><strong>解决方案</strong>：使用API调试工具（如APIFox）</p>
<p><strong>优势</strong>：</p>
<table>
<thead>
<tr class="header">
<th>优势</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>可视化操作</strong></td>
<td>图形界面，操作简单</td>
</tr>
<tr class="even">
<td><strong>支持所有HTTP方法</strong></td>
<td>GET、POST、PUT、DELETE等</td>
</tr>
<tr class="odd">
<td><strong>自动生成文档</strong></td>
<td>测试的同时生成接口文档</td>
</tr>
<tr class="even">
<td><strong>团队协作</strong></td>
<td>可以分享接口给团队成员</td>
</tr>
</tbody>
</table>
<h3 id="apifox简介">5.5.2 APIFox简介</h3>
<p><strong>APIFox</strong> =
一款集API设计、开发、测试、文档于一体的工具</p>
<p><strong>核心功能</strong>：</p>
<ul>
<li>✅ <strong>API测试</strong>：发送请求，查看响应</li>
<li>✅ <strong>接口文档</strong>：自动生成接口文档</li>
<li>✅ <strong>Mock数据</strong>：模拟后端数据，前端可以先开发</li>
<li>✅ <strong>团队协作</strong>：多人协作开发</li>
</ul>
<h3 id="apifox基本使用">5.5.3 APIFox基本使用</h3>
<p><strong>第一步：创建请求</strong></p>
<ol type="1">
<li>打开APIFox，点击"新建请求"</li>
<li>选择HTTP方法（GET、POST等）</li>
<li>输入接口地址（如：<code>http://localhost:8000/api/users</code>）</li>
</ol>
<p><strong>第二步：设置请求参数</strong></p>
<p><strong>GET请求示例</strong>（查询用户列表）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">方法：GET</span><br><span class="line">URL：http://localhost:8000/api/users</span><br><span class="line">查询参数：</span><br><span class="line">  - page: 1</span><br><span class="line">  - limit: 10</span><br><span class="line">  - status: active</span><br></pre></td></tr></table></figure>
<p><strong>POST请求示例</strong>（创建用户）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">方法：POST</span><br><span class="line">URL：http://localhost:8000/api/users</span><br><span class="line">请求头：</span><br><span class="line">  Content-Type: application/json</span><br><span class="line">请求体（JSON）：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;张三&quot;,</span><br><span class="line">  &quot;email&quot;: &quot;zhangsan@example.com&quot;,</span><br><span class="line">  &quot;password&quot;: &quot;123456&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>第三步：设置认证信息</strong></p>
<p>如果需要Bearer Token认证：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">请求头：</span><br><span class="line">  Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</span><br></pre></td></tr></table></figure>
<p><strong>第四步：发送请求并查看响应</strong></p>
<p>点击"发送"按钮，查看响应结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zhangsan@example.com&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">100</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="实际例子测试文件上传api">5.5.4 实际例子：测试文件上传API</h3>
<p><strong>场景</strong>：测试前面设计的文件上传接口</p>
<p><strong>步骤</strong>：</p>
<ol type="1">
<li><p><strong>创建POST请求</strong> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">方法：POST</span><br><span class="line">URL：http://localhost:8000/api/files/upload</span><br></pre></td></tr></table></figure></p></li>
<li><p><strong>设置请求体</strong></p>
<ul>
<li><p>选择"form-data"格式</p></li>
<li><p>添加字段：</p>
<ul>
<li><code>file</code>: 选择文件（类型：File）</li>
<li><code>type</code>: <code>image</code>（类型：Text）</li>
</ul></li>
</ul></li>
<li><p><strong>发送请求</strong></p>
<ul>
<li>点击"发送"</li>
<li>查看响应结果</li>
</ul></li>
</ol>
<p><strong>APIFox界面示意</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">┌─────────────────────────────────────┐</span><br><span class="line">│ POST  http://localhost:8000/api/... │</span><br><span class="line">├─────────────────────────────────────┤</span><br><span class="line">│ 请求参数                             │</span><br><span class="line">│ ┌─────────────────────────────────┐ │</span><br><span class="line">│ │ file    [选择文件] [image.jpg]  │ │</span><br><span class="line">│ │ type    [image]                 │ │</span><br><span class="line">│ └─────────────────────────────────┘ │</span><br><span class="line">│                                     │</span><br><span class="line">│ [发送]                              │</span><br><span class="line">│                                     │</span><br><span class="line">│ 响应结果                             │</span><br><span class="line">│ ┌─────────────────────────────────┐ │</span><br><span class="line">│ │ &#123;                                │ │</span><br><span class="line">│ │   &quot;code&quot;: 200,                   │ │</span><br><span class="line">│ │   &quot;message&quot;: &quot;上传成功&quot;,          │ │</span><br><span class="line">│ │   &quot;data&quot;: &#123; ... &#125;                │ │</span><br><span class="line">│ │ &#125;                                │ │</span><br><span class="line">│ └─────────────────────────────────┘ │</span><br><span class="line">└─────────────────────────────────────┘</span><br></pre></td></tr></table></figure>
<h3 id="apifox高级功能">5.5.5 APIFox高级功能</h3>
<p><strong>1. 环境变量</strong></p>
<p>可以设置不同环境（开发、测试、生产）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">开发环境：</span><br><span class="line">  base_url: http://localhost:8000</span><br><span class="line"></span><br><span class="line">生产环境：</span><br><span class="line">  base_url: https://api.example.com</span><br></pre></td></tr></table></figure>
<p><strong>2. 前置脚本和后置脚本</strong></p>
<ul>
<li><strong>前置脚本</strong>：请求前执行（如：自动生成Token）</li>
<li><strong>后置脚本</strong>：请求后执行（如：提取响应数据）</li>
</ul>
<p><strong>3. 接口文档自动生成</strong></p>
<p>测试接口后，可以一键生成接口文档，分享给前端团队。</p>
<p><strong>4. Mock数据</strong></p>
<p>后端还没开发完？可以用APIFox生成Mock数据，前端先开发。</p>
<h3 id="其他api调试工具">5.5.6 其他API调试工具</h3>
<table>
<thead>
<tr class="header">
<th>工具</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Postman</strong></td>
<td>老牌工具，功能强大</td>
</tr>
<tr class="even">
<td><strong>APIFox</strong></td>
<td>国产工具，界面友好，功能全面</td>
</tr>
<tr class="odd">
<td><strong>Insomnia</strong></td>
<td>轻量级，界面简洁</td>
</tr>
<tr class="even">
<td><strong>Thunder Client</strong></td>
<td>VS Code插件，集成在编辑器中</td>
</tr>
</tbody>
</table>
<blockquote>
<p>💡 <strong>推荐</strong>：<br />
对于初学者，推荐使用APIFox，界面友好，功能全面，而且有中文支持。</p>
</blockquote>
<hr />
<h1 id="选讲api版本控制">6. 选讲：API版本控制</h1>
<h2 id="为什么需要版本控制">6.1 为什么需要版本控制？</h2>
<p><strong>问题场景</strong>：</p>
<ul>
<li>API需要更新，但旧版本还在使用</li>
<li>直接修改API会破坏现有功能</li>
</ul>
<p><strong>解决方案</strong>：API版本控制</p>
<hr />
<h2 id="版本控制的方式">6.2 版本控制的方式</h2>
<h3 id="url路径版本控制">6.2.1 URL路径版本控制</h3>
<p><strong>方式</strong>：在URL中包含版本号</p>
<p><strong>实际例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/v1/users          # 版本1</span><br><span class="line">/v2/users          # 版本2</span><br><span class="line">/api/v1/users      # 带api前缀的版本1</span><br></pre></td></tr></table></figure>
<p><strong>优点</strong>：</p>
<ul>
<li>直观，一眼看出版本</li>
<li>易于管理</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>URL变长</li>
</ul>
<hr />
<h3 id="请求头版本控制">6.2.2 请求头版本控制</h3>
<p><strong>方式</strong>：在HTTP请求头中指定版本</p>
<p><strong>实际例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /users</span><br><span class="line">Headers: &#123;</span><br><span class="line">    &quot;Accept&quot;: &quot;application/vnd.api+json;version=2&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>优点</strong>：</p>
<ul>
<li>URL不变，更简洁</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>不够直观</li>
</ul>
<hr />
<h3 id="查询参数版本控制">6.2.3 查询参数版本控制</h3>
<p><strong>方式</strong>：在查询参数中指定版本</p>
<p><strong>实际例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /users?version=2</span><br></pre></td></tr></table></figure>
<p><strong>优点</strong>：</p>
<ul>
<li>简单易用</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>容易忘记加版本参数</li>
</ul>
<hr />
<h2 id="版本控制策略">6.3 版本控制策略</h2>
<h3 id="何时创建新版本">6.3.1 何时创建新版本？</h3>
<p><strong>需要创建新版本的情况</strong>：</p>
<ul>
<li>✅ 修改了响应格式（字段名、结构变化）</li>
<li>✅ 删除了接口</li>
<li>✅ 修改了必填参数</li>
</ul>
<p><strong>不需要创建新版本的情况</strong>：</p>
<ul>
<li>✅ 添加了新字段（向后兼容）</li>
<li>✅ 添加了新接口</li>
<li>✅ 修复了bug</li>
</ul>
<hr />
<h3 id="版本兼容策略">6.3.2 版本兼容策略</h3>
<p><strong>策略</strong>：</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>策略</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>同时支持多版本</strong></td>
<td>旧版本和新版本都可用</td>
<td>v1和v2同时提供服务</td>
</tr>
<tr class="even">
<td><strong>逐步废弃</strong></td>
<td>先发布新版本，再废弃旧版本</td>
<td>v1标记为deprecated，6个月后删除</td>
</tr>
<tr class="odd">
<td><strong>强制升级</strong></td>
<td>直接废弃旧版本</td>
<td>直接删除v1，只保留v2</td>
</tr>
</tbody>
</table>
<p><strong>推荐策略</strong>：同时支持多版本 + 逐步废弃</p>
<hr />
<h2 id="rest架构风格理解">6.4 REST架构风格理解</h2>
<h3 id="rest的核心原则">6.4.1 REST的核心原则</h3>
<p><strong>REST的6个约束</strong>：</p>
<ol type="1">
<li><strong>客户端-服务器</strong>：前后端分离</li>
<li><strong>无状态</strong>：每次请求都包含完整信息</li>
<li><strong>可缓存</strong>：响应可以被缓存</li>
<li><strong>统一接口</strong>：使用标准的HTTP方法</li>
<li><strong>分层系统</strong>：可以有多层（代理、网关等）</li>
<li><strong>按需代码</strong>：可以返回可执行代码（可选）</li>
</ol>
<hr />
<h3 id="restful-vs-非restful">6.4.2 RESTful vs 非RESTful</h3>
<p><strong>对比</strong>：</p>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>RESTful</th>
<th>非RESTful</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>URL设计</strong></td>
<td>资源导向</td>
<td>动作导向</td>
</tr>
<tr class="even">
<td><strong>HTTP方法</strong></td>
<td>使用标准方法</td>
<td>只用GET/POST</td>
</tr>
<tr class="odd">
<td><strong>状态码</strong></td>
<td>使用标准状态码</td>
<td>都用200</td>
</tr>
<tr class="even">
<td><strong>数据格式</strong></td>
<td>JSON</td>
<td>各种格式</td>
</tr>
</tbody>
</table>
<p><strong>实际例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">RESTful：</span><br><span class="line">GET    /users/1</span><br><span class="line">POST   /users</span><br><span class="line">PUT    /users/1</span><br><span class="line">DELETE /users/1</span><br><span class="line"></span><br><span class="line">非RESTful：</span><br><span class="line">GET /getUser?id=1</span><br><span class="line">POST /createUser</span><br><span class="line">POST /updateUser?id=1</span><br><span class="line">POST /deleteUser?id=1</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="本章总结">本章总结</h2>
<p>通过本章的学习，你已经掌握了：</p>
<p>✅ <strong>RESTful规范</strong>：</p>
<ul>
<li>资源命名规范</li>
<li>HTTP方法的使用</li>
<li>URL设计规范</li>
<li>HTTP状态码</li>
</ul>
<p>✅ <strong>API设计原则</strong>：</p>
<ul>
<li>统一性原则</li>
<li>简洁性原则</li>
<li>可扩展性原则</li>
<li>安全性原则</li>
</ul>
<p>✅ <strong>接口文档编写</strong>：</p>
<ul>
<li>接口文档的结构</li>
<li>使用工具编写文档</li>
<li>文档的重要性</li>
</ul>
<p>✅ <strong>实战技能</strong>：</p>
<ul>
<li>设计RESTful接口</li>
<li>使用AI设计API</li>
<li>编写接口文档</li>
</ul>
<p>✅ <strong>进阶知识</strong>（选讲）：</p>
<ul>
<li>API版本控制</li>
<li>REST架构风格</li>
</ul>
<blockquote>
<p>🌟 <strong>恭喜你！</strong><br />
你已经掌握了RESTful API设计的核心技能！<br />
这些知识将帮助你：</p>
<ul>
<li><p>设计规范的API接口</p></li>
<li><p>编写清晰的接口文档</p></li>
<li><p>提高前后端协作效率</p></li>
</ul>
<p><strong>记住</strong>：好的API设计是前后端协作的基础！<br />
<strong>继续练习，继续探索，API设计的世界等着你！</strong> 🚀</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.csgrandeur.cn/2025-12-16-11-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E4%B8%8E%E8%AE%BE%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CSGrandeur">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025-12-16-11-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E4%B8%8E%E8%AE%BE%E8%AE%A1/" class="post-title-link" itemprop="url">11.需求分析与设计</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-12-16 18:05:45 / 修改时间：18:40:54" itemprop="dateCreated datePublished" datetime="2025-12-16T18:05:45+08:00">2025-12-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="为什么需要需求分析与设计">1. 为什么需要需求分析与设计？</h1>
<h2 id="开发前的思考">1.1 开发前的思考</h2>
<p><strong>常见问题</strong>：</p>
<ul>
<li><strong>直接写代码</strong>：写着写着发现需求不清楚，要重写</li>
<li><strong>没有规划</strong>：功能混乱，用户体验差</li>
<li><strong>沟通不畅</strong>：开发者和用户理解不一致</li>
</ul>
<p><strong>生活类比</strong>：</p>
<ul>
<li><strong>没有需求分析</strong>：像盖房子不画图纸，盖到一半发现不对</li>
<li><strong>有需求分析</strong>：先画图纸，再施工，事半功倍</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025-12-16-11-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E4%B8%8E%E8%AE%BE%E8%AE%A1/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.csgrandeur.cn/2025-12-16-10-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CSGrandeur">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025-12-16-10-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" class="post-title-link" itemprop="url">10.数据可视化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-12-16 14:21:02 / 修改时间：18:03:23" itemprop="dateCreated datePublished" datetime="2025-12-16T14:21:02+08:00">2025-12-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="为什么需要数据可视化">1. 为什么需要数据可视化？</h1>
<h2 id="数据的价值">1.1 数据的价值</h2>
<p><strong>数据</strong> = 信息，但原始数据很难理解</p>
<p><strong>生活类比</strong>：</p>
<ul>
<li><strong>原始数据</strong>：1000个数字（看不懂）</li>
<li><strong>可视化</strong>：把这些数字变成图表（一眼看懂）</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025-12-16-10-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.csgrandeur.cn/2025-12-16-09-%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CSGrandeur">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025-12-16-09-%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" class="post-title-link" itemprop="url">09.前端工程化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-12-16 14:09:02 / 修改时间：17:58:16" itemprop="dateCreated datePublished" datetime="2025-12-16T14:09:02+08:00">2025-12-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="为什么需要前端工程化">1. 为什么需要前端工程化？</h1>
<h2 id="传统开发的痛点">1.1 传统开发的痛点</h2>
<p>在之前的章节中，我们使用CDN直接引入Vue.js，这种方式适合学习，但在实际项目中会遇到问题：</p>
<p><strong>问题</strong>：</p>
<ul>
<li><strong>依赖管理混乱</strong>：不知道项目用了哪些库，版本是多少</li>
<li><strong>代码重复</strong>：每个页面都要写相同的网络请求代码</li>
<li><strong>配置分散</strong>：API地址、环境配置写在代码里，难以管理</li>
<li><strong>难以协作</strong>：不同开发者环境不同，代码运行结果不一致</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025-12-16-09-%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.csgrandeur.cn/2025-12-08-08-%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91%E4%B8%8EUI%E6%A1%86%E6%9E%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CSGrandeur">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025-12-08-08-%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91%E4%B8%8EUI%E6%A1%86%E6%9E%B6/" class="post-title-link" itemprop="url">08.组件开发与UI框架</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-08 20:44:25" itemprop="dateCreated datePublished" datetime="2025-12-08T20:44:25+08:00">2025-12-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-12-16 14:08:41" itemprop="dateModified" datetime="2025-12-16T14:08:41+08:00">2025-12-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="组件通信机制组件间的数据传递">1.
组件通信机制：组件间的数据传递</h1>
<h2 id="为什么需要组件通信">1.1 为什么需要组件通信？</h2>
<p>在第七章中，我们学习了Vue.js的基础组件概念。然而，在实际开发中，组件往往不是孤立存在的，它们需要相互协作、传递数据。</p>
<p><strong>实际场景</strong>：</p>
<ul>
<li>父组件需要向子组件传递数据（如用户信息）</li>
<li>子组件需要向父组件通知事件（如按钮点击）</li>
<li>兄弟组件之间需要共享数据（如购物车状态）</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025-12-08-08-%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91%E4%B8%8EUI%E6%A1%86%E6%9E%B6/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.csgrandeur.cn/2025-11-24-07-%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CSGrandeur">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025-11-24-07-%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">07.前端框架入门</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-11-24 20:25:51" itemprop="dateCreated datePublished" datetime="2025-11-24T20:25:51+08:00">2025-11-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-12-02 18:46:43" itemprop="dateModified" datetime="2025-12-02T18:46:43+08:00">2025-12-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="为什么需要前端框架">1. 为什么需要前端框架？</h1>
<h2 id="传统开发的痛点">1.1 传统开发的痛点</h2>
<p>在之前的章节中，我们使用原生JavaScript实现了待办事项应用。</p>
<p><strong>问题</strong>：</p>
<ul>
<li>需要<strong>手动操作DOM</strong>（创建元素、更新元素）</li>
<li>数据和界面<strong>不同步</strong>（数据变了，界面不会自动更新）</li>
<li>代码<strong>重复</strong>（每次都要写<code>createElement</code>、<code>appendChild</code>）</li>
</ul>
<p>原生JavaScript需要开发者手动管理数据与DOM的同步，当应用复杂度增加时，这种手动管理方式会导致代码冗余、难以维护，且容易出现状态不一致的问题。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025-11-24-07-%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E5%85%A5%E9%97%A8/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.csgrandeur.cn/2025-11-24-06-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AD%98%E5%82%A8%E4%B8%8E%E8%B7%A8%E5%9F%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CSGrandeur">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025-11-24-06-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AD%98%E5%82%A8%E4%B8%8E%E8%B7%A8%E5%9F%9F/" class="post-title-link" itemprop="url">06.浏览器存储与跨域</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-11-24 20:25:43" itemprop="dateCreated datePublished" datetime="2025-11-24T20:25:43+08:00">2025-11-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-11-25 10:21:51" itemprop="dateModified" datetime="2025-11-25T10:21:51+08:00">2025-11-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="为什么需要浏览器存储">1. 为什么需要浏览器存储？</h1>
<h2 id="问题的出现数据丢失">1.1 问题的出现：数据丢失</h2>
<p>在之前的待办事项应用中，每次刷新页面后，用户输入的数据都会丢失。这是因为原生JavaScript操作的数据仅存在于内存中，页面刷新会导致内存清空。</p>
<p><strong>核心问题</strong>：<br />
Web应用需要将数据持久化存储，以便在页面刷新或重新访问时能够恢复用户数据，提升用户体验。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025-11-24-06-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AD%98%E5%82%A8%E4%B8%8E%E8%B7%A8%E5%9F%9F/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.csgrandeur.cn/2025-11-24-05-%E7%8E%B0%E4%BB%A3JavaScript/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CSGrandeur">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025-11-24-05-%E7%8E%B0%E4%BB%A3JavaScript/" class="post-title-link" itemprop="url">05.现代JavaScript</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-11-24 20:25:36" itemprop="dateCreated datePublished" datetime="2025-11-24T20:25:36+08:00">2025-11-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-11-25 10:21:51" itemprop="dateModified" datetime="2025-11-25T10:21:51+08:00">2025-11-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="为什么需要现代javascript">1. 为什么需要现代JavaScript？</h1>
<h2 id="从回调地狱到优雅异步">1.1 从"回调地狱"到"优雅异步"</h2>
<p>在第四章中，我们学习了JavaScript的基础语法、DOM操作、事件监听和表单验证。然而，当需要处理异步操作（如网络请求、文件读取）时，传统的回调函数方式会导致代码结构复杂、难以维护。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025-11-24-05-%E7%8E%B0%E4%BB%A3JavaScript/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://blog.csgrandeur.cn/2025-11-18-04-JavaScript%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CSGrandeur">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | CSGrandeur's Thinking">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025-11-18-04-JavaScript%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">04.JavaScript基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-11-18 11:01:30" itemprop="dateCreated datePublished" datetime="2025-11-18T11:01:30+08:00">2025-11-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-11-25 10:21:51" itemprop="dateModified" datetime="2025-11-25T10:21:51+08:00">2025-11-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="javascript是什么为什么需要它">1.
JavaScript是什么？为什么需要它？</h1>
<h2 id="从静态到动态htmlcss与javascript的关系">1.1
从"静态"到"动态"：HTML、CSS与JavaScript的关系</h2>
<p>还记得我们之前学的HTML和CSS吗？</p>
<ul>
<li><strong>HTML</strong> = 网页的"骨架"（结构）</li>
<li><strong>CSS</strong> = 网页的"皮肤"（样式）</li>
<li><strong>JavaScript</strong> = 网页的"大脑"（行为）</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2025-11-18-04-JavaScript%E5%9F%BA%E7%A1%80/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">CSGrandeur</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://fastly.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://fastly.jsdelivr.net/npm/@next-theme/pjax@0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.1/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://fastly.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"CSGrandeur/csgrandeur.github.io","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
